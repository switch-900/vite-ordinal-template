<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nexus Builder</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <script src="/content/5d82695b820a676ba23cda5390249f295eacb1a97e4df20fc02eaa501bd20eedi0"></script>
  <script src="/content/609b117277f1e9c9f27f358fe02db34e13d08915bbcea18770dc36f5f3afcbb2i2"></script>
  <link rel="icon" href="/content/cfab194b924f7785c6e453728e1c264b89b74843633278cda3ad3f57576c1e93i0">
  <script type="module" crossorigin>import{jsx as e,jsxs as t,Fragment as O}from"react/jsx-runtime";import J,{createContext as H,useState as k,useCallback as C,useContext as W,useRef as P,useEffect as j,Suspense as F}from"react";import X from"react-dom/client";import{useThree as Z,Canvas as B}from"@react-three/fiber";import{Perf as q}from"r3f-perf";import{OrthographicCamera as Y,PerspectiveCamera as Q,CameraControls as K,Environment as U,Grid as ee,TransformControls as te}from"@react-three/drei";import*as N from"three";import{Geometry as re,Base as ne,Addition as T,Subtraction as A,Intersection as R}from"@react-three/csg";import{boxelGeometry as E}from"/content/c0dec9591190449efc84e972ebc6b96e98a6ce971faa79357e0e688167934131i0";import se from"three-custom-shader-material";import{Leva as ae}from"leva";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))d(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&d(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function d(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();class oe{constructor(){this.history=[],this.currentIndex=-1,this.maxHistorySize=50}saveState(c,o="Unknown Action"){this.currentIndex<this.history.length-1&&(this.history=this.history.slice(0,this.currentIndex+1)),this.history.push({state:JSON.parse(JSON.stringify(c)),description:o,timestamp:Date.now()}),this.history.length>this.maxHistorySize?this.history.shift():this.currentIndex++}undo(){return this.canUndo()?(this.currentIndex--,this.history[this.currentIndex]):null}redo(){return this.canRedo()?(this.currentIndex++,this.history[this.currentIndex]):null}canUndo(){return this.currentIndex>0}canRedo(){return this.currentIndex<this.history.length-1}getCurrentInfo(){return this.currentIndex>=0&&this.currentIndex<this.history.length?this.history[this.currentIndex]:null}getUndoInfo(){return this.canUndo()?this.history[this.currentIndex-1]:null}getRedoInfo(){return this.canRedo()?this.history[this.currentIndex+1]:null}clear(){this.history=[],this.currentIndex=-1}}const ie=new oe,V=H(),_={objects:[],selectedIds:[],selectedObjectId:null,viewMode:"3d",currentTool:"Line",transformMode:"translate",snapToGrid:!0,gridSize:.5,showGrid:!0,layers:[{id:"default",name:"Default Layer",visible:!0,locked:!1,color:"#3b82f6"}],groups:[]},ce=({children:a})=>{const[c,o]=k(_),d=C(s=>{o(typeof s=="function"?r=>({...r,...s(r)}):r=>({...r,...s}))},[]),i={...c,setSceneState:d};return e(V.Provider,{value:i,children:a})},le=(a="Action")=>{},f=()=>{const a=W(V);if(!a)throw new Error("useScene must be used within a SceneProvider");return a};ie.saveState(_,"Initial State");const S=()=>{const{setSceneState:a}=f(),c=C(m=>{m.layerId||(m.layerId="default"),le(`Add ${m.type||m.geometry}`),a(h=>({objects:[...h.objects,m]}))},[a]),o=C(m=>{a({selectedIds:m,selectedObjectId:m.length===1?m[0]:null})},[a]),d=C(m=>{a(h=>{const g=h.selectedIds.includes(m)?h.selectedIds.filter(x=>x!==m):[...h.selectedIds,m];return{selectedIds:g,selectedObjectId:g.length===1?g[0]:null}})},[a]),i=C(()=>{a({selectedIds:[],selectedObjectId:null})},[a]),s=C((m,h)=>{a(l=>({objects:l.objects.map(g=>g.id===m?{...g,...h}:g)}))},[a]),r=C(m=>{a(h=>({objects:h.objects.filter(l=>l.id!==m),selectedIds:h.selectedIds.filter(l=>l!==m),selectedObjectId:h.selectedObjectId===m?null:h.selectedObjectId}))},[a]);return{addObject:c,selectObjects:o,toggleObjectSelection:d,clearSelection:i,updateObject:s,deleteObject:r}},de=()=>{const a=P(),c=P(),{viewMode:o}=f();return t(O,{children:[e(Y,{ref:a,makeDefault:o==="2d",position:[0,10,0],rotation:[-Math.PI/2,0,0],zoom:50}),e(Q,{ref:c,makeDefault:o==="3d",fov:45,position:[5,5,5]}),o==="3d"&&e(K,{makeDefault:!1})]})},me=()=>{const{selectedIds:a,viewMode:c,setSceneState:o}=f(),{deleteObject:d,clearSelection:i}=S();j(()=>{const s=r=>{if(!(c!=="3d"||r.target.tagName==="INPUT"||r.target.tagName==="TEXTAREA"))switch(r.key.toLowerCase()){case"z":(r.ctrlKey||r.metaKey)&&(r.preventDefault(),r.shiftKey?console.log("Redo - temporarily disabled during migration"):console.log("Undo - temporarily disabled during migration"));break;case"y":(r.ctrlKey||r.metaKey)&&(r.preventDefault(),console.log("Redo - temporarily disabled during migration"));break;case"delete":case"backspace":r.preventDefault(),a.forEach(m=>d(m));break;case"escape":r.preventDefault(),i();break;case"g":!r.ctrlKey&&!r.metaKey&&(r.preventDefault(),o({transformMode:"translate"}));break;case"r":!r.ctrlKey&&!r.metaKey&&(r.preventDefault(),o({transformMode:"rotate"}));break;case"s":!r.ctrlKey&&!r.metaKey&&(r.preventDefault(),o({transformMode:"scale"}));break;case"h":r.preventDefault(),o(m=>({showGrid:!m.showGrid}));break;case"tab":r.preventDefault(),o(m=>({snapToGrid:!m.snapToGrid}));break;case"1":r.preventDefault(),o({viewMode:"3d"});break;case"2":r.preventDefault(),o({viewMode:"2d"});break}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[a,c])},he=()=>e(U,{environmentIntensity:.75,files:"/content/8c4ea8f9fafef081345ba8a72c08efed2373d0ba33ac92aca5f043071fc42909i0"}),ge=()=>{const a=P();return j(()=>{window.gridFloor=a.current},[]),e(ee,{gridSize:[1,1],cellSize:.1,cellThickness:1,cellColor:"#6f6f6f",sectionSize:1,sectionThickness:1.5,sectionColor:"#ff6600",fadeDistance:200,fadeStrength:50,followCamera:!0,infiniteGrid:!0,position:[0,-.5,0],ref:a})},ue=()=>{const{scene:a,camera:c,gl:o}=Z(),{currentTool:d}=f(),[i,s]=k([]),[r,m]=k(!1),h=P(null),l=P(null),g=n=>{switch(n.stopPropagation(),m(!0),d){case"Line":case"Path":x(n);break;case"Rectangle":v(n);break}},x=n=>{const u=[n.point.clone()],p=new N.LineBasicMaterial({color:"orange"}),b=new N.BufferGeometry().setFromPoints(u),w=new N.Line(b,p);a.add(w),h.current={line:w,points:u}},v=n=>{const u=n.point.clone(),p=new N.LineBasicMaterial({color:"orange"}),b=new N.BufferGeometry,w=new N.LineLoop(b,p);a.add(w),l.current={line:w,startPoint:u}},M=n=>{if(r)switch(n.stopPropagation(),d){case"Line":case"Path":D(n);break;case"Rectangle":L(n);break}},D=n=>{if(!h.current)return;const u=n.point.clone();if(d==="Path")h.current.points.push(u),h.current.line.geometry.setFromPoints(h.current.points);else{const p=[h.current.points[0],u];h.current.line.geometry.setFromPoints(p)}},L=n=>{if(!l.current)return;const u=n.point.clone(),p=l.current.startPoint,b=[new N.Vector3(p.x,p.y,p.z),new N.Vector3(u.x,p.y,p.z),new N.Vector3(u.x,u.y,p.z),new N.Vector3(p.x,u.y,p.z)];l.current.line.geometry.setFromPoints(b)},$=n=>{r&&(n.stopPropagation(),m(!1),h.current&&(s(u=>[...u,h.current.line]),h.current=null),l.current&&(s(u=>[...u,l.current.line]),l.current=null))};return t(O,{children:[e("gridHelper",{args:[20,20,"#444","#222"],rotation:[0,0,0]}),t("mesh",{rotation:[-Math.PI/2,0,0],position:[0,0,0],onPointerDown:g,onPointerMove:M,onPointerUp:$,children:[e("planeGeometry",{args:[100,100]}),e("meshBasicMaterial",{visible:!1})]})]})},pe=[{name:"Line",icon:"📏"},{name:"Rectangle",icon:"⬛"},{name:"Polygon",icon:"🔺"},{name:"Path",icon:"✏️"},{name:"Select",icon:"🖱️"}],xe=()=>{const{currentTool:a,setSceneState:c}=f();return t("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10 flex items-center space-x-2 bg-gray-900 bg-opacity-90 p-2 rounded-lg shadow-lg",children:[e("span",{className:"text-white text-sm mr-2",children:"Draw Tools:"}),pe.map(o=>t("button",{className:`px-3 py-1 rounded flex items-center space-x-1 transition-colors ${a===o.name?"bg-orange-600 text-white":"bg-gray-700 text-gray-200 hover:bg-gray-600"}`,onClick:()=>c({currentTool:o.name}),children:[e("span",{children:o.icon}),e("span",{className:"text-sm",children:o.name})]},o.name))]})},ye=({selectedMesh:a})=>{const{transformMode:c,selectedObjectId:o}=f(),{updateObject:d}=S(),i=P(!1),s=C(r=>{var l;if(!o||!((l=r==null?void 0:r.target)!=null&&l.object)||i.current)return;i.current=!0;const m=r.target.object,h={position:[m.position.x,m.position.y,m.position.z],rotation:[m.rotation.x,m.rotation.y,m.rotation.z],scale:[m.scale.x,m.scale.y,m.scale.z]};d(o,h),setTimeout(()=>{i.current=!1},10)},[o,d]);return!a||!o?null:e(te,{object:a,mode:c||"translate",showX:!0,showY:!0,showZ:!0,space:"world",size:.8,onObjectChange:s,enabled:!0,visible:!0})},fe=()=>{const{objects:a,selectedObjectId:c,selectedIds:o,layers:d,groups:i=[],transformMode:s}=f(),{selectObjects:r,toggleObjectSelection:m,clearSelection:h}=S(),l=P({}),g=a.filter(n=>{const u=d.find(b=>b.id===n.layerId),p=u?u.visible:!0;if(n.groupId){const b=i.find(G=>G.id===n.groupId),w=b?b.visible:!0;return p&&w}return p}),x=(n,u)=>{u.stopPropagation(),u.ctrlKey||u.metaKey?m(n):r([n])},v=n=>{n.stopPropagation(),h()},M=()=>c?l.current[c]:null,D=(n,u)=>{switch(n){case"box":return e("boxGeometry",{args:u});case"sphere":return e("sphereGeometry",{args:u});case"cylinder":return e("cylinderGeometry",{args:u});case"plane":return e("planeGeometry",{args:u});case"cone":return e("coneGeometry",{args:u});case"boxel":return E;default:return e("boxGeometry",{args:[1,1,1]})}},L=n=>{const u=a.filter(y=>n.sourceObjects.includes(y.id));if(u.length<2)return null;const[p,b,...w]=u,G=y=>[y.position[0]-n.position[0],y.position[1]-n.position[1],y.position[2]-n.position[2]],I=y=>e("mesh",{position:G(y),rotation:y.rotation,scale:y.scale,children:D(y.geometry,y.geometryArgs)});return t(re,{children:[e(ne,{children:I(p)}),n.operation==="union"&&t(T,{children:[I(b),w.map(y=>e(T,{children:I(y)},y.id))]}),n.operation==="subtract"&&t(A,{children:[I(b),w.map(y=>e(A,{children:I(y)},y.id))]}),n.operation==="intersect"&&t(R,{children:[I(b),w.map(y=>e(R,{children:I(y)},y.id))]})]})},$=(n,u,p=!1)=>p?e(se,{baseMaterial:N.MeshStandardMaterial,flatShading:!0,transparent:!0,uniforms:{time:{value:0}},vertexShader:`
            attribute float angle;
            varying vec3 vPos;
            varying vec3 vNormal;
            void main() {
              csm_Position += normal * 0.1 * 0.5;
              vPos = csm_Position;
              vNormal = normal;
            }
          `,fragmentShader:`
            varying vec3 vPos;
            varying vec3 vNormal;
            void main() {
              vec3 color = ${u?"vec3(1.0, 0.7, 0.0)":"vec3(1.0, 0.4, 0.0)"};
              csm_DiffuseColor = vec4(color, 0.9);
            }
          `}):e("meshStandardMaterial",{color:u?"#ffaa00":n.color,metalness:n.metalness||.1,roughness:n.roughness||.8,transparent:u||n.opacity!==void 0&&n.opacity<1,opacity:u?.8:n.opacity||1,emissive:n.emissive||"#000000",emissiveIntensity:n.emissiveIntensity||0});return t(O,{children:[t("mesh",{position:[0,-.01,0],rotation:[-Math.PI/2,0,0],onClick:v,visible:!1,children:[e("planeGeometry",{args:[1e3,1e3]}),e("meshBasicMaterial",{transparent:!0,opacity:0})]}),t("group",{children:[g.map(n=>{if(!n.visible)return null;const u=o.includes(n.id);return n.type==="boolean"?t("mesh",{ref:p=>{p&&(l.current[n.id]=p)},position:n.position,rotation:n.rotation,scale:n.scale,onClick:p=>x(n.id,p),children:[L(n),$(n.material,u)]},n.id):t("mesh",{ref:p=>{p&&(l.current[n.id]=p)},position:n.position,rotation:n.rotation,scale:n.scale,onClick:p=>x(n.id,p),geometry:n.geometry==="boxel"?E:void 0,children:[n.geometry!=="boxel"&&D(n.geometry,n.geometryArgs),$(n.material,u,n.geometry==="boxel")]},n.id)}),e(ye,{selectedMesh:M()})]})]})},be=()=>t("div",{className:"pointer-events-none gloww absolute flex flex-col justify-center text-orange-500 p-2 px-3 text-xl",children:[t("div",{className:"flex",children:[e("div",{className:"w-6 h-6 min-w-6 bg-orange-400 mt-1.5 mr-1.5 rounded-sm"}),e("span",{className:"opacity-80 pr-1.5 pt-1",children:e("i",{children:"the"})}),' "',e("span",{className:"text-orange-400 text-3xl hover:text-lime-400 pointer-events-auto cursor-crosshair",children:"boxel"}),'"']}),t("div",{className:"text-md w-[200px] flex flex-col",children:[t("div",{children:["a ",e("span",{className:"text-orange-300",children:"faceted cube"})," with multiple shapes, all in one geometry!"]}),e("div",{className:"text-sm text-orange-300 pt-2 opacity-80",children:"the 'angle' shader attribute moves the vertices along their normals"})]})]}),ve=({sceneData:a,onBackToBuilder:c})=>{const o=()=>{if(!a)return null;if(typeof a=="string")try{return JSON.parse(a).map((r,m)=>t("mesh",{position:r.position,rotation:r.rotation,scale:r.scale,children:[d(r.geometry,r.args),i(r.material)]},m))}catch(s){return console.error("Failed to parse scene data:",s),null}return null},d=(s,r)=>{switch(s){case"box":return e("boxGeometry",{args:r});case"sphere":return e("sphereGeometry",{args:r});case"cylinder":return e("cylinderGeometry",{args:r});case"plane":return e("planeGeometry",{args:r});case"cone":return e("coneGeometry",{args:r});default:return e("boxGeometry",{args:[1,1,1]})}},i=s=>e("meshStandardMaterial",{color:s.color,metalness:s.metalness,roughness:s.roughness});return t("div",{className:"w-full h-full",children:[t("div",{className:"absolute top-2 left-2 z-10 bg-gray-900 bg-opacity-80 text-white p-2 rounded",children:[e("h3",{className:"text-sm font-bold",children:"3D Viewer"}),e("p",{className:"text-xs text-gray-300",children:"Orbit • Pan • Zoom"}),c&&e("button",{className:"mt-2 px-2 py-1 bg-orange-600 text-white rounded text-xs hover:bg-orange-700",onClick:c,children:"← Back to Builder"})]}),t(B,{camera:{position:[5,5,5],fov:45},dpr:1,children:[e("color",{attach:"background",args:[.1,.1,.12]}),t(F,{fallback:null,children:[e(U,{preset:"city",environmentIntensity:.3}),e("ambientLight",{intensity:.5}),e("directionalLight",{position:[10,10,5],intensity:1}),o(),e(K,{makeDefault:!0})]})]})]})},Ne=()=>{const{viewMode:a,setSceneState:c,selectedIds:o}=f();S();const d=s=>{switch(s){case"Move":c({transformMode:"translate"});break;case"Rotate":c({transformMode:"rotate"});break;case"Scale":c({transformMode:"scale"});break}};return t("div",{className:"w-full bg-gray-800 border-b border-gray-700 shadow-lg",children:[t("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-900",children:[e("div",{className:"flex items-center space-x-1",children:e("div",{className:"text-orange-500 font-bold text-lg",children:"3D Builder"})}),t("div",{className:"flex items-center space-x-2",children:[e("button",{onClick:()=>c({viewMode:"2d"}),className:`px-3 py-1 rounded text-sm ${a==="2d"?"bg-orange-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"2D Sketch"}),e("button",{onClick:()=>c({viewMode:"3d"}),className:`px-3 py-1 rounded text-sm ${a==="3d"?"bg-orange-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"3D Model"})]})]}),e("div",{className:"flex items-center px-2 py-1 bg-gray-800 overflow-x-auto",children:[{name:"File",icon:"📁",items:["New","Open","Save","Export"]},{name:"Edit",icon:"✏️",items:["Undo","Redo","Copy","Paste"]},{name:"View",icon:"👁️",items:["2D","3D","Grid","Wireframe"]},{name:"Draw",icon:"✏️",items:["Line","Rectangle","Circle","Polygon"]},{name:"Modify",icon:"🔧",items:["Move","Rotate","Scale","Mirror"],hasAction:!0},{name:"Tools",icon:"🛠️",items:["Measure","Text","Dimension"]}].map(s=>t("div",{className:"relative group",children:[t("button",{className:"flex items-center space-x-1 px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 rounded",children:[e("span",{children:s.icon}),e("span",{children:s.name})]}),e("div",{className:"absolute top-full left-0 mt-1 w-40 bg-gray-900 border border-gray-700 rounded shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50",children:s.items.map(r=>e("button",{onClick:()=>s.hasAction&&d(r),className:`w-full text-left px-3 py-2 text-sm transition-colors first:rounded-t last:rounded-b ${s.hasAction?"text-gray-300 hover:bg-gray-700":"text-gray-500 cursor-not-allowed"}`,disabled:!s.hasAction,children:r},r))})]},s.name))})]})},z=[{name:"Cube",icon:"⬛",type:"box"},{name:"Sphere",icon:"🟠",type:"sphere"},{name:"Cylinder",icon:"🗜️",type:"cylinder"},{name:"Plane",icon:"▭",type:"plane"},{name:"Cone",icon:"🔺",type:"cone"},{name:"Boxel",icon:"📦",type:"boxel"}],we=()=>{const{addObject:a,selectObjects:c}=S(),o=d=>{const i=`${d}_${Date.now()}`,s=[0,0,0],r=[0,0,0],m=[1,1,1];let h;switch(d){case"box":h=[1,1,1];break;case"sphere":h=[.5,32,16];break;case"cylinder":h=[.5,.5,1,32];break;case"plane":h=[2,2];break;case"cone":h=[.5,1,32];break;case"boxel":h=[1];break;default:h=[1,1,1]}const l={id:i,name:`${d}_${z.length+1}`,type:"mesh",geometry:d,geometryArgs:h,material:{type:"standard",color:"#ff6600",metalness:.1,roughness:.7},position:s,rotation:r,scale:m,visible:!0,locked:!1};a(l),c([i])};return t("div",{className:"space-y-3",children:[e("h3",{className:"text-white text-sm font-bold",children:"Add Primitives"}),e("div",{className:"grid grid-cols-2 gap-2",children:z.map(d=>t("button",{className:"px-3 py-2 rounded flex flex-col items-center space-y-1 bg-gray-800 text-gray-200 hover:bg-orange-600 transition-colors",onClick:()=>o(d.type),children:[e("span",{className:"text-lg",children:d.icon}),e("span",{className:"text-xs",children:d.name})]},d.name))})]})},ke=[{name:"Extrude",icon:"⬆️",type:"extrude"},{name:"Revolve",icon:"🔄",type:"revolve"},{name:"Union",icon:"➕",type:"union"},{name:"Subtract",icon:"➖",type:"subtract"},{name:"Intersect",icon:"✂️",type:"intersect"},{name:"Mirror",icon:"🪞",type:"mirror"}],Se=()=>{const{objects:a,selectedIds:c}=f(),{addObject:o,updateObject:d,selectObjects:i}=S(),s=m=>{const h=a.filter(v=>c.includes(v.id));if(h.length<2)return;const l=h.map(v=>new N.Vector3(...v.position)),g=l.reduce((v,M)=>v.add(M),new N.Vector3).divideScalar(l.length),x={id:`boolean_${m}_${Date.now()}`,name:`Boolean_${m}`,type:"boolean",operation:m,sourceObjects:c.slice(),position:[g.x,g.y,g.z],rotation:[0,0,0],scale:[1,1,1],material:{color:"#4a90e2",metalness:.1,roughness:.8},visible:!0,locked:!1};o(x),c.forEach(v=>{d(v,{visible:!1})}),i([x.id])},r=m=>{const h=a.filter(l=>c.includes(l.id));switch(m){case"extrude":if(h.length===1){const l=h[0],g={id:`extruded_${Date.now()}`,name:`${l.name}_extruded`,type:"mesh",geometry:l.geometry,geometryArgs:l.geometryArgs?[l.geometryArgs[0],l.geometryArgs[1],l.geometryArgs[1]*2]:[1,1,2],material:{...l.material},position:[...l.position],rotation:[...l.rotation],scale:[...l.scale],visible:!0,locked:!1};o(g),i([g.id])}break;case"revolve":if(h.length===1){const l=h[0],g={id:`revolved_${Date.now()}`,name:`${l.name}_revolved`,type:"mesh",geometry:"cylinder",geometryArgs:[.5,.5,1,32],material:{...l.material},position:[...l.position],rotation:[...l.rotation],scale:[...l.scale],visible:!0,locked:!1};o(g),i([g.id])}break;case"union":h.length>=2&&s("union");break;case"subtract":h.length>=2&&s("subtract");break;case"intersect":h.length>=2&&s("intersect");break;case"mirror":h.length>=1&&h.forEach(l=>{const g={...l,id:`${l.id}_mirror_${Date.now()}`,name:`${l.name}_mirror`,position:[-l.position[0],l.position[1],l.position[2]]};o(g)});break;default:console.log("Unknown operation:",m)}};return t("div",{className:"space-y-3",children:[e("h3",{className:"text-white text-sm font-bold",children:"Advanced"}),e("div",{className:"grid grid-cols-2 gap-2",children:ke.map(m=>t("button",{className:`px-3 py-2 rounded flex flex-col items-center space-y-1 ${m.type!=="mirror"&&c.length<2?"bg-gray-800 text-gray-500 cursor-not-allowed":"bg-gray-800 text-gray-200 hover:bg-orange-600 transition-colors"}`,onClick:()=>r(m.type),disabled:m.type!=="mirror"&&c.length<2,children:[e("span",{className:"text-lg",children:m.icon}),e("span",{className:"text-xs",children:m.name})]},m.name))})]})},Ce=()=>{const{selectedObjectId:a,objects:c}=f(),{updateObject:o}=S(),d=a?c.find(r=>r.id===a):null,i=(r,m)=>{if(d){const h=d.material||{};o(d.id,{material:{...h,[r]:m}});const l=document.getElementById(`mesh-${d.id}`);l&&l.classList.toggle("material-update")}};if(!d)return t("div",{className:"text-gray-400 text-center py-8",children:[e("div",{className:"text-4xl mb-2",children:"🎨"}),e("p",{children:"Select an object to edit materials"})]});const s=(d==null?void 0:d.material)||{};return t("div",{className:"space-y-4",children:[e("div",{className:"flex justify-between items-center",children:e("h3",{className:"text-white text-sm font-bold",children:"Material Editor"})}),e("div",{className:"mb-4",children:t("p",{className:"text-xs text-gray-400 mb-2",children:["Object: ",(d==null?void 0:d.type)||(d==null?void 0:d.geometry)," (",d==null?void 0:d.id.slice(0,8),"...)"]})}),t("div",{className:"mb-4",children:[e("label",{className:"block text-xs text-gray-400 mb-2",children:"Color:"}),t("div",{className:"flex items-center space-x-2",children:[e("input",{type:"color",value:s.color||"#808080",onChange:r=>i("color",r.target.value),className:"w-8 h-8 rounded border border-gray-600"}),e("input",{type:"text",value:s.color||"#808080",onChange:r=>i("color",r.target.value),className:"flex-1 px-2 py-1 bg-gray-800 text-white rounded text-xs",placeholder:"#808080"})]})]}),t("div",{className:"mb-4",children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Metalness: ",(s.metalness||.1).toFixed(2)]}),e("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.metalness||.1,onChange:r=>i("metalness",parseFloat(r.target.value)),className:"w-full"})]}),t("div",{className:"mb-4",children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Roughness: ",(s.roughness||.8).toFixed(2)]}),e("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.roughness||.8,onChange:r=>i("roughness",parseFloat(r.target.value)),className:"w-full"})]}),t("div",{className:"mb-4",children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Opacity: ",(s.opacity||1).toFixed(2)]}),e("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.opacity||1,onChange:r=>i("opacity",parseFloat(r.target.value)),className:"w-full"})]}),t("div",{className:"mb-4",children:[e("label",{className:"block text-xs text-gray-400 mb-2",children:"Emissive:"}),t("div",{className:"flex items-center space-x-2",children:[e("input",{type:"color",value:s.emissive||"#000000",onChange:r=>i("emissive",r.target.value),className:"w-8 h-8 rounded border border-gray-600"}),e("input",{type:"text",value:s.emissive||"#000000",onChange:r=>i("emissive",r.target.value),className:"flex-1 px-2 py-1 bg-gray-800 text-white rounded text-xs",placeholder:"#000000"})]})]}),t("div",{className:"mb-4",children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Emissive Intensity: ",(s.emissiveIntensity||0).toFixed(2)]}),e("input",{type:"range",min:"0",max:"2",step:"0.01",value:s.emissiveIntensity||0,onChange:r=>i("emissiveIntensity",parseFloat(r.target.value)),className:"w-full"})]}),t("div",{className:"mb-4",children:[e("label",{className:"block text-xs text-gray-400 mb-2",children:"Presets:"}),t("div",{className:"grid grid-cols-2 gap-1",children:[e("button",{className:"px-2 py-1 bg-gray-700 text-white rounded text-xs hover:bg-gray-600",onClick:()=>{const r={...d.material,color:"#808080",metalness:0,roughness:.9};o(d.id,{material:r})},children:"Plastic"}),e("button",{className:"px-2 py-1 bg-gray-700 text-white rounded text-xs hover:bg-gray-600",onClick:()=>{const r={...d.material,color:"#c0c0c0",metalness:1,roughness:.2};o(d.id,{material:r})},children:"Metal"}),e("button",{className:"px-2 py-1 bg-gray-700 text-white rounded text-xs hover:bg-gray-600",onClick:()=>{const r={...d.material,color:"#8B4513",metalness:0,roughness:.8};o(d.id,{material:r})},children:"Wood"}),e("button",{className:"px-2 py-1 bg-gray-700 text-white rounded text-xs hover:bg-gray-600",onClick:()=>{i("color","#ffffff"),i("metalness",0),i("roughness",.1),i("opacity",.3)},children:"Glass"})]})]})]})},Me=()=>{const{objects:a,selectedIds:c,setSceneState:o}=f(),{selectObjects:d,deleteObject:i}=S(),s=l=>{o(g=>({objects:g.objects.map(x=>x.id===l?{...x,visible:!x.visible}:x)}))},r=l=>{o(g=>({objects:g.objects.map(x=>x.id===l?{...x,locked:!x.locked}:x)}))},m=l=>{i(l)},h=l=>{d([l])};return t("div",{className:"space-y-3",children:[t("h3",{className:"text-white text-sm font-bold",children:["Objects (",a.length,")"]}),a.length===0?t("div",{className:"text-gray-400 text-center py-8",children:[e("div",{className:"text-4xl mb-2",children:"📦"}),e("p",{children:"No objects in scene"})]}):e("div",{className:"space-y-1 max-h-96 overflow-y-auto",children:a.map(l=>t("div",{className:`flex items-center space-x-2 p-1 rounded text-xs cursor-pointer ${c.includes(l.id)?"bg-orange-600":"bg-gray-700 hover:bg-gray-600"}`,onClick:()=>h(l.id),children:[e("button",{className:`w-4 h-4 text-xs ${l.visible?"text-green-400":"text-gray-500"}`,onClick:g=>{g.stopPropagation(),s(l.id)},children:"👁"}),e("button",{className:`w-4 h-4 text-xs ${l.locked?"text-red-400":"text-gray-500"}`,onClick:g=>{g.stopPropagation(),r(l.id)},children:"🔒"}),e("span",{className:"flex-1 truncate",children:l.name}),e("button",{className:"w-4 h-4 text-red-400 hover:text-red-300",onClick:g=>{g.stopPropagation(),m(l.id)},children:"✕"})]},l.id))})]})};function Ie(){const{layers:a,objects:c}=f(),[o,d]=k(""),i=()=>console.log("Layer management temporarily disabled"),s=()=>console.log("Layer management temporarily disabled"),r=()=>console.log("Layer management temporarily disabled"),m=()=>console.log("Layer management temporarily disabled"),h=()=>console.log("Layer management temporarily disabled"),[l,g]=k(!1),x=()=>{o.trim()&&(i({id:Date.now().toString(),name:o.trim(),visible:!0,locked:!1,color:`#${Math.floor(Math.random()*16777215).toString(16)}`}),d(""))},v=n=>{a.length>1&&s()},M=(n,u)=>{n.dataTransfer.setData("text/plain",u)},D=n=>{n.preventDefault()},L=(n,u)=>{n.preventDefault(),n.dataTransfer.getData("text/plain"),m()},$=n=>c.filter(u=>u.layerId===n);return l?t("div",{className:"absolute top-20 right-2 z-20 bg-gray-900 text-white p-4 rounded-lg shadow-xl w-80 max-h-96 overflow-y-auto",children:[t("div",{className:"flex justify-between items-center mb-3",children:[e("h3",{className:"text-lg font-semibold",children:"Layer Manager"}),e("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-white",children:"✕"})]}),t("div",{className:"mb-4 flex gap-2",children:[e("input",{type:"text",value:o,onChange:n=>d(n.target.value),onKeyDown:n=>n.key==="Enter"&&x(),placeholder:"New layer name",className:"flex-1 px-2 py-1 bg-gray-700 text-white rounded border border-gray-600 focus:border-orange-500 outline-none"}),e("button",{onClick:x,className:"px-3 py-1 bg-orange-600 text-white rounded hover:bg-orange-700",children:"+"})]}),e("div",{className:"space-y-2",children:a.map(n=>{const u=$(n.id);return t("div",{className:"border border-gray-700 rounded p-2",onDragOver:D,onDrop:p=>L(p,n.id),children:[t("div",{className:"flex items-center justify-between mb-2",children:[t("div",{className:"flex items-center gap-2 flex-1",children:[e("div",{className:"w-4 h-4 rounded border border-gray-600",style:{backgroundColor:n.color}}),e("span",{className:"text-sm font-medium",children:n.name}),t("span",{className:"text-xs text-gray-400",children:["(",u.length,")"]})]}),t("div",{className:"flex gap-1",children:[e("button",{onClick:()=>h(n.id),className:`text-xs px-2 py-1 rounded ${n.visible?"bg-green-600 hover:bg-green-700":"bg-gray-600 hover:bg-gray-700"}`,title:n.visible?"Hide layer":"Show layer",children:n.visible?"👁️":"🙈"}),e("button",{onClick:()=>r(n.id,{locked:!n.locked}),className:`text-xs px-2 py-1 rounded ${n.locked?"bg-red-600 hover:bg-red-700":"bg-gray-600 hover:bg-gray-700"}`,title:n.locked?"Unlock layer":"Lock layer",children:n.locked?"🔒":"🔓"}),a.length>1&&e("button",{onClick:()=>v(n.id),className:"text-xs px-2 py-1 rounded bg-red-600 hover:bg-red-700",title:"Delete layer",children:"🗑️"})]})]}),u.length>0&&e("div",{className:"ml-4 space-y-1",children:u.map(p=>t("div",{draggable:!0,onDragStart:b=>M(b,p.id),className:"flex items-center justify-between p-1 bg-gray-800 rounded text-xs cursor-move hover:bg-gray-700",children:[t("span",{children:[p.type||p.geometry," - ",p.id.slice(0,8)]}),p.material&&e("div",{className:"w-3 h-3 rounded border border-gray-600",style:{backgroundColor:p.material.color||"#ffffff"}})]},p.id))})]},n.id)})}),e("div",{className:"mt-4 text-xs text-gray-400",children:"💡 Drag objects between layers to organize your scene"})]}):e("div",{className:"absolute top-20 right-2 z-20",children:e("button",{onClick:()=>g(!0),className:"px-3 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 shadow-lg",children:"📁 Layers"})})}const Oe=()=>{const{snapToGrid:a,gridSize:c,showGrid:o,setSceneState:d}=f(),i=(s,r)=>{d({[s]:r})};return t("div",{className:"space-y-4",children:[e("h3",{className:"text-white text-sm font-bold",children:"Settings"}),t("div",{className:"mb-4",children:[e("h4",{className:"text-xs text-gray-400 mb-2",children:"Grid & Snap"}),t("div",{className:"flex items-center justify-between mb-2",children:[e("label",{className:"text-xs",children:"Show Grid"}),e("input",{type:"checkbox",checked:o,onChange:s=>i("showGrid",s.target.checked),className:"w-4 h-4"})]}),t("div",{className:"flex items-center justify-between mb-2",children:[e("label",{className:"text-xs",children:"Snap to Grid"}),e("input",{type:"checkbox",checked:a,onChange:s=>i("snapToGrid",s.target.checked),className:"w-4 h-4"})]}),t("div",{className:"mb-2",children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Grid Size: ",c]}),e("input",{type:"range",min:"0.1",max:"2",step:"0.1",value:c,onChange:s=>i("gridSize",parseFloat(s.target.value)),className:"w-full"})]})]}),t("div",{className:"mb-4",children:[e("h4",{className:"text-xs text-gray-400 mb-2",children:"Performance"}),t("div",{className:"text-xs text-gray-300",children:[t("div",{children:["Objects: ",f().objects.length]}),t("div",{children:["Selected: ",f().selectedIds.length]})]})]}),t("div",{className:"mb-4",children:[e("h4",{className:"text-xs text-gray-400 mb-2",children:"Shortcuts"}),t("div",{className:"text-xs text-gray-300 space-y-1",children:[t("div",{children:[e("kbd",{className:"bg-gray-700 px-1 rounded",children:"G"})," - Translate"]}),t("div",{children:[e("kbd",{className:"bg-gray-700 px-1 rounded",children:"R"})," - Rotate"]}),t("div",{children:[e("kbd",{className:"bg-gray-700 px-1 rounded",children:"S"})," - Scale"]}),t("div",{children:[e("kbd",{className:"bg-gray-700 px-1 rounded",children:"Esc"})," - Deselect"]}),t("div",{children:[e("kbd",{className:"bg-gray-700 px-1 rounded",children:"Del"})," - Delete"]})]})]})]})},Pe=a=>`<>
${a.filter(o=>o.visible).map(o=>{const d=$e(o.geometry,o.geometryArgs),i=Le(o.material);return`  <mesh position={[${o.position.join(", ")}]} rotation={[${o.rotation.join(", ")}]} scale={[${o.scale.join(", ")}]}>
    ${d}
    ${i}
  </mesh>`}).join(`
`)}
</>`,De=a=>JSON.stringify(a.filter(c=>c.visible).map(c=>({type:c.type,geometry:c.geometry,args:c.geometryArgs,material:c.material,position:c.position,rotation:c.rotation,scale:c.scale})),null,2),$e=(a,c)=>{const o=c?`args={[${c.join(", ")}]}`:"";return`<${a}Geometry ${o} />`},Le=a=>{const c=Object.entries(a).map(([o,d])=>typeof d=="string"?`${o}="${d}"`:`${o}={${d}}`).join(" ");return`<mesh${a.type.charAt(0).toUpperCase()+a.type.slice(1)}Material ${c} />`},Ge=({onLoadInViewer:a})=>{const{objects:c}=f(),[o,d]=k("jsx"),[i,s]=k(""),r=()=>{const l=o==="jsx"?Pe(c):De(c);s(l)},m=()=>{navigator.clipboard.writeText(i)},h=()=>{i&&a&&a(i)};return t("div",{className:"space-y-4",children:[e("h3",{className:"text-white text-sm font-bold",children:"Export Scene"}),t("div",{className:"flex space-x-2",children:[e("button",{className:`px-3 py-1 rounded text-xs ${o==="jsx"?"bg-orange-600":"bg-gray-700"}`,onClick:()=>d("jsx"),children:"JSX"}),e("button",{className:`px-3 py-1 rounded text-xs ${o==="json"?"bg-orange-600":"bg-gray-700"}`,onClick:()=>d("json"),children:"JSON"})]}),t("button",{className:"w-full px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:r,disabled:c.length===0,children:["Generate ",o.toUpperCase()," Code"]}),i&&t("div",{className:"space-y-2",children:[t("div",{className:"flex space-x-2",children:[e("button",{className:"flex-1 px-2 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700",onClick:m,children:"Copy"}),o==="jsx"&&e("button",{className:"flex-1 px-2 py-1 bg-purple-600 text-white rounded text-xs hover:bg-purple-700",onClick:h,children:"View"})]}),e("textarea",{className:"w-full h-24 bg-gray-800 text-white p-2 rounded text-xs font-mono",value:i,readOnly:!0})]}),c.length===0&&t("div",{className:"text-gray-400 text-center py-4",children:[e("div",{className:"text-2xl mb-2",children:"📤"}),e("p",{className:"text-xs",children:"Add objects to export"})]})]})},Te=({onLoadInViewer:a})=>{var l;const{viewMode:c}=f(),[o,d]=k("primitives"),[i,s]=k(!1),m=[{id:"primitives",name:"Primitives",icon:"⬛",component:we},{id:"advanced",name:"Advanced",icon:"🔧",component:Se},{id:"materials",name:"Materials",icon:"🎨",component:Ce},{id:"objects",name:"Objects",icon:"📦",component:Me},{id:"layers",name:"Layers",icon:"📚",component:Ie},{id:"export",name:"Export",icon:"📤",component:Ge},{id:"settings",name:"Settings",icon:"⚙️",component:Oe}].filter(g=>c==="2d"?["objects","layers","export","settings"].includes(g.id):!0),h=(l=m.find(g=>g.id===o))==null?void 0:l.component;return t("div",{className:`bg-gray-900 border-r border-gray-700 flex flex-col transition-all duration-300 ${i?"w-12":"w-80"}`,children:[t("div",{className:"flex items-center justify-between p-3 border-b border-gray-700",children:[!i&&e("h2",{className:"text-white font-semibold",children:"Tools"}),e("button",{onClick:()=>s(!i),className:"p-1 text-gray-400 hover:text-white rounded",children:i?"▶":"◀"})]}),e("div",{className:`flex ${i?"flex-col":"flex-wrap"} ${i?"items-center":"border-b border-gray-700"}`,children:m.map(g=>t("button",{onClick:()=>d(g.id),className:`${i?"w-10 h-10 m-1":"flex-1 min-w-0 px-3 py-2"} flex items-center justify-center text-sm transition-colors ${o===g.id?"bg-orange-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-800"}`,title:g.name,children:[e("span",{className:"text-lg",children:g.icon}),!i&&e("span",{className:"ml-2 truncate",children:g.name})]},g.id))}),!i&&e("div",{className:"flex-1 overflow-y-auto",children:h&&e("div",{className:"p-4",children:e(h,{onLoadInViewer:a})})})]})},Ae=()=>{const{objects:a,selectedIds:c,viewMode:o,currentTool:d,snapToGrid:i,gridSize:s,transformMode:r}=f(),m=c.length,h=a.length,l=a.filter(x=>x.visible).length,g=()=>m===0?"Select objects to modify them • Click primitives in sidebar to add objects":o==="3d"&&m>0?`Transform mode: ${r} • Press ${r==="translate"?"G":r==="rotate"?"R":r==="scale"?"S":""} to switch • Drag gizmo to transform`:"Use transform tools or edit properties in the sidebar";return t("div",{className:"bg-gray-900 border-t border-gray-700 px-4 py-2 flex items-center justify-between text-sm text-gray-400",children:[t("div",{className:"flex items-center space-x-4",children:[t("span",{children:["Objects: ",l,"/",h]}),m>0&&t("span",{className:"text-orange-400",children:["Selected: ",m]}),t("span",{children:["Mode: ",o.toUpperCase()]}),o==="2d"&&t("span",{children:["Tool: ",d]})]}),e("div",{className:"text-center flex-1",children:e("span",{className:"text-blue-300",children:g()})}),t("div",{className:"flex items-center space-x-4",children:[t("div",{className:"flex items-center space-x-2",children:[e("span",{className:`w-2 h-2 rounded-full ${i?"bg-green-500":"bg-gray-600"}`}),t("span",{children:["Grid: ",s,"m"]})]}),e("span",{children:"Coords: [0, 0, 0]"})]})]})},Re=({children:a,onLoadInViewer:c})=>t("div",{className:"w-full h-full flex flex-col bg-gray-800 overflow-hidden",children:[e(Ne,{}),t("div",{className:"flex-1 flex overflow-hidden",children:[e(Te,{onLoadInViewer:c}),e("div",{className:"flex-1 relative bg-gray-900",children:a})]}),e(Ae,{})]}),Ee=()=>{const{selectedIds:a,transformMode:c,setSceneState:o}=f(),{clearSelection:d}=S(),i=[{id:"translate",icon:"↔",name:"Move"},{id:"rotate",icon:"🔄",name:"Rotate"},{id:"scale",icon:"↗",name:"Scale"}];return t("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-10 flex items-center space-x-2 bg-gray-900 bg-opacity-90 p-2 rounded-lg shadow-lg",children:[e("div",{className:"text-white text-sm px-2",children:a.length===0?e("span",{className:"text-gray-400",children:"No selection"}):t("span",{children:[a.length," selected"]})}),a.length>0&&e("div",{className:"w-px h-6 bg-gray-600"}),a.length>0&&t(O,{children:[e("div",{className:"flex space-x-1",children:i.map(s=>t("button",{onClick:()=>o({transformMode:s.id}),className:`px-3 py-1 rounded text-sm transition-colors ${c===s.id?"bg-orange-600 text-white shadow-lg":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:`${s.name} (${s.id==="translate"?"G":s.id==="rotate"?"R":"S"})`,children:[e("span",{className:"mr-1",children:s.icon}),s.name]},s.id))}),e("div",{className:"w-px h-6 bg-gray-600"}),e("button",{onClick:d,className:"px-3 py-1 rounded text-sm bg-gray-700 text-gray-300 hover:bg-red-600 hover:text-white transition-colors",title:"Clear Selection (Esc)",children:"✕ Clear"})]}),a.length>0&&t(O,{children:[e("div",{className:"w-px h-6 bg-gray-600"}),t("div",{className:"text-xs text-gray-400 px-2",children:["Mode: ",e("span",{className:"text-orange-400 font-medium",children:c||"translate"})]})]})]})};function ze(){const[a,c]=k("builder"),[o,d]=k(null);me();const i=()=>{const{viewMode:s}=f();return t(O,{children:[s==="2d"&&e(xe,{}),s==="3d"&&e(Ee,{}),t(B,{dpr:1,children:[e(de,{}),e("color",{attach:"background",args:[.02,.02,.022]}),e(F,{children:s==="2d"?e(ue,{}):t(O,{children:[e(he,{}),e(fe,{}),e(ge,{}),window.innerWidth<300?null:e(q,{position:"bottom-left"})]})})]})]})};return a==="viewer"?e(ve,{sceneData:o,onBackToBuilder:()=>c("builder")}):t(Re,{onLoadInViewer:s=>{d(s),c("viewer")},children:[e(i,{}),e(ae,{hidden:window.innerWidth<300}),e(be,{})]})}X.createRoot(document.getElementById("root")).render(e(J.StrictMode,{children:e(ce,{children:e(ze,{})})}));
</script>
  <style rel="stylesheet">@font-face{font-family:Font;src:url(/content/74eed71c46430c38e056ef1bc69ad2c521293a8941d2177b52e7d447b42d5522i0)}html,body,#root{margin:0;width:100%;height:100%;background:#333;font-family:Font,serif}.gloww{text-shadow:0 0 55px #ff9900,0 0 32px rgba(255,119,0,.7),0 0 7px #000,0 0 16px #000,0 0 3px #bf00ff}
</style>
</head>
<body><div id="root"></div></body>
</html>
