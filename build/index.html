<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nexus Builder</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <script src="/content/5d82695b820a676ba23cda5390249f295eacb1a97e4df20fc02eaa501bd20eedi0"></script>
  <script src="/content/609b117277f1e9c9f27f358fe02db34e13d08915bbcea18770dc36f5f3afcbb2i2"></script>
  <link rel="icon" href="/content/cfab194b924f7785c6e453728e1c264b89b74843633278cda3ad3f57576c1e93i0">
  <script type="module" crossorigin>import{jsx as e,jsxs as t,Fragment as V}from"react/jsx-runtime";import Z,{createContext as pe,useState as $,useCallback as G,useContext as xe,useEffect as B,Suspense as be,useMemo as K,useRef as Y}from"react";import ye from"react-dom/client";import{Leva as fe}from"leva";import{Canvas as oe,useThree as ie,useFrame as ce}from"@react-three/fiber";import{Environment as le,CameraControls as J,OrthographicCamera as ve,TransformControls as we,Grid as Ne}from"@react-three/drei";import*as z from"three";import{getMondrian as de,getPatternArrayData as ke}from"bitmon";import{Geometry as Se,Base as Me,Addition as te,Subtraction as ne,Intersection as re}from"@react-three/csg";import{boxelGeometry as se}from"boxels-shader";import De from"three-custom-shader-material";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))y(o);new MutationObserver(o=>{for(const g of o)if(g.type==="childList")for(const r of g.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&y(r)}).observe(document,{childList:!0,subtree:!0});function d(o){const g={};return o.integrity&&(g.integrity=o.integrity),o.referrerPolicy&&(g.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?g.credentials="include":o.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function y(o){if(o.ep)return;o.ep=!0;const g=d(o);fetch(o.href,g)}})();class Ce{constructor(){this.history=[],this.currentIndex=-1,this.maxHistorySize=50}saveState(s,d="Unknown Action"){this.currentIndex<this.history.length-1&&(this.history=this.history.slice(0,this.currentIndex+1)),this.history.push({state:JSON.parse(JSON.stringify(s)),description:d,timestamp:Date.now()}),this.history.length>this.maxHistorySize?this.history.shift():this.currentIndex++}undo(){return this.canUndo()?(this.currentIndex--,this.history[this.currentIndex]):null}redo(){return this.canRedo()?(this.currentIndex++,this.history[this.currentIndex]):null}canUndo(){return this.currentIndex>0}canRedo(){return this.currentIndex<this.history.length-1}getCurrentInfo(){return this.currentIndex>=0&&this.currentIndex<this.history.length?this.history[this.currentIndex]:null}getUndoInfo(){return this.canUndo()?this.history[this.currentIndex-1]:null}getRedoInfo(){return this.canRedo()?this.history[this.currentIndex+1]:null}clear(){this.history=[],this.currentIndex=-1}}const Pe=new Ce,me=pe(),he={objects:[],selectedIds:[],selectedObjectId:null,viewMode:"3d",view2DMode:"front",currentTool:"Line",transformMode:"translate",snapToGrid:!0,gridSize:.5,showGrid:!0,layers:[{id:"default",name:"Default Layer",visible:!0,locked:!1,color:"#3b82f6"}],groups:[]},$e=({children:c})=>{const[s,d]=$(he),y=G(g=>{d(typeof g=="function"?r=>({...r,...g(r)}):r=>({...r,...g}))},[]),o={...s,setSceneState:y};return e(me.Provider,{value:o,children:c})},Ie=(c="Action")=>{},j=()=>{const c=xe(me);if(!c)throw new Error("useScene must be used within a SceneProvider");return c};Pe.saveState(he,"Initial State");const F=()=>{const{setSceneState:c}=j(),s=G(f=>{f.layerId||(f.layerId="default"),Ie(`Add ${f.type||f.geometry}`),c(h=>({objects:[...h.objects,f]}))},[c]),d=G(f=>{c({selectedIds:f,selectedObjectId:f.length===1?f[0]:null})},[c]),y=G(f=>{c(h=>{const l=h.selectedIds.includes(f)?h.selectedIds.filter(n=>n!==f):[...h.selectedIds,f];return{selectedIds:l,selectedObjectId:l.length===1?l[0]:null}})},[c]),o=G(()=>{c({selectedIds:[],selectedObjectId:null})},[c]),g=G((f,h)=>{c(p=>({objects:p.objects.map(l=>l.id===f?{...l,...h}:l)}))},[c]),r=G(f=>{c(h=>({objects:h.objects.filter(p=>p.id!==f),selectedIds:h.selectedIds.filter(p=>p!==f),selectedObjectId:h.selectedObjectId===f?null:h.selectedObjectId}))},[c]);return{addObject:s,selectObjects:d,toggleObjectSelection:y,clearSelection:o,updateObject:g,deleteObject:r}},Ae=()=>{const{selectedIds:c,viewMode:s,setSceneState:d}=j(),{deleteObject:y,clearSelection:o}=F();B(()=>{const g=r=>{if(!(s!=="3d"||r.target.tagName==="INPUT"||r.target.tagName==="TEXTAREA"))switch(console.log(`Key pressed: ${r.key}, transform mode activated`),r.key.toLowerCase()){case"z":(r.ctrlKey||r.metaKey)&&(r.preventDefault(),r.shiftKey?console.log("Redo - temporarily disabled during migration"):console.log("Undo - temporarily disabled during migration"));break;case"y":(r.ctrlKey||r.metaKey)&&(r.preventDefault(),console.log("Redo - temporarily disabled during migration"));break;case"delete":case"backspace":r.preventDefault(),c.forEach(f=>y(f));break;case"escape":!r.shiftKey&&!r.ctrlKey&&!r.metaKey&&(r.preventDefault(),d(f=>f.selectedIds.length>0&&f.transformMode?{transformMode:"translate"}:(o(),{})));break;case"g":!r.ctrlKey&&!r.metaKey&&(r.preventDefault(),d({transformMode:"translate"}));break;case"r":!r.ctrlKey&&!r.metaKey&&(r.preventDefault(),d({transformMode:"rotate"}));break;case"s":!r.ctrlKey&&!r.metaKey&&(r.preventDefault(),d({transformMode:"scale"}));break;case"h":r.preventDefault(),d(f=>({showGrid:!f.showGrid}));break;case"tab":r.preventDefault(),d(f=>({snapToGrid:!f.snapToGrid}));break;case"1":r.preventDefault(),d({viewMode:"3d"});break;case"2":r.preventDefault(),d({viewMode:"2d",view2DMode:"front"});break;case"3":r.preventDefault(),d({viewMode:"2d",view2DMode:"top"});break;case"4":r.preventDefault(),d({viewMode:"2d",view2DMode:"right"});break;case"5":r.preventDefault(),d({viewMode:"2d",view2DMode:"left"});break;case"6":r.preventDefault(),d({viewMode:"2d",view2DMode:"back"});break;case"7":r.preventDefault(),d({viewMode:"2d",view2DMode:"bottom"});break}};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[c,s])},ze=()=>t("div",{className:"pointer-events-none gloww absolute flex flex-col justify-center text-orange-500 p-2 px-3 text-xl",children:[t("div",{className:"flex",children:[e("div",{className:"w-6 h-6 min-w-6 bg-orange-400 mt-1.5 mr-1.5 rounded-sm"}),e("span",{className:"opacity-80 pr-1.5 pt-1",children:e("i",{children:"the"})}),' "',e("span",{className:"text-orange-400 text-3xl hover:text-lime-400 pointer-events-auto cursor-crosshair",children:"boxel"}),'"']}),t("div",{className:"text-md w-[200px] flex flex-col",children:[t("div",{children:["a ",e("span",{className:"text-orange-300",children:"faceted cube"})," with multiple shapes, all in one geometry!"]}),e("div",{className:"text-sm text-orange-300 pt-2 opacity-80",children:"the 'angle' shader attribute moves the vertices along their normals"})]})]}),Oe=({sceneData:c,onBackToBuilder:s})=>{const d=()=>{if(!c)return null;if(typeof c=="string")try{return JSON.parse(c).map((r,f)=>t("mesh",{position:r.position,rotation:r.rotation,scale:r.scale,children:[y(r.geometry,r.args),o(r.material)]},f))}catch(g){return console.error("Failed to parse scene data:",g),null}return null},y=(g,r)=>{switch(g){case"box":return e("boxGeometry",{args:r});case"sphere":return e("sphereGeometry",{args:r});case"cylinder":return e("cylinderGeometry",{args:r});case"plane":return e("planeGeometry",{args:r});case"cone":return e("coneGeometry",{args:r});default:return e("boxGeometry",{args:[1,1,1]})}},o=g=>e("meshStandardMaterial",{color:g.color,metalness:g.metalness,roughness:g.roughness});return t("div",{className:"w-full h-full",children:[t("div",{className:"absolute top-2 left-2 z-10 bg-gray-900 bg-opacity-80 text-white p-2 rounded",children:[e("h3",{className:"text-sm font-bold",children:"3D Viewer"}),e("p",{className:"text-xs text-gray-300",children:"Orbit â€¢ Pan â€¢ Zoom"}),s&&e("button",{className:"mt-2 px-2 py-1 bg-orange-600 text-white rounded text-xs hover:bg-orange-700",onClick:s,children:"â† Back to Builder"})]}),t(oe,{camera:{position:[5,5,5],fov:45},dpr:1,children:[e("color",{attach:"background",args:[.1,.1,.12]}),t(be,{fallback:null,children:[e(le,{preset:"city",environmentIntensity:.3}),e("ambientLight",{intensity:.5}),e("directionalLight",{position:[10,10,5],intensity:1}),d(),e(J,{makeDefault:!0})]})]})]})},Te=()=>{var l;const{viewMode:c,view2DMode:s,currentTool:d,setSceneState:y,selectedIds:o}=j(),{clearSelection:g}=F(),r=[{id:"front",name:"Front",icon:"ðŸ“",key:"2"},{id:"top",name:"Top",icon:"â¬›",key:"3"},{id:"right",name:"Right",icon:"ðŸ“",key:"4"},{id:"left",name:"Left",icon:"ðŸ“",key:"5"},{id:"back",name:"Back",icon:"ðŸ“",key:"6"},{id:"bottom",name:"Bottom",icon:"â¬›",key:"7"}],p=[{name:"File",icon:"ðŸ“",items:["New","Open","Save","Export"],hasAction:!0,handler:n=>{switch(n){case"New":confirm("Start a new project? This will clear the current scene.")&&g();break;case"Save":console.log("Save functionality would go here");break;case"Export":console.log("Export functionality would go here");break}}},{name:"Edit",icon:"âœï¸",items:["Undo","Redo","Copy","Paste"]},{name:"View",icon:"ðŸ‘ï¸",items:["Grid","Wireframe","Shaded","Realistic"]},{name:"Modify",icon:"ðŸ”§",items:["Move","Rotate","Scale","Mirror"],hasAction:!0,handler:n=>{switch(n){case"Move":y({transformMode:"translate"});break;case"Rotate":y({transformMode:"rotate"});break;case"Scale":y({transformMode:"scale"});break}}}];return t("div",{className:"w-full bg-gray-800 border-b border-gray-700 shadow-lg",children:[t("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-900",children:[e("div",{className:"flex items-center space-x-1",children:e("div",{className:"text-orange-500 font-bold text-lg",children:"ðŸŸ§ Bitmap Nexus Builder ðŸŸ§"})}),t("div",{className:"flex items-center space-x-4",children:[t("div",{className:"flex bg-gray-800 rounded-lg p-1",children:[t("button",{onClick:()=>y({viewMode:"2d"}),className:`px-4 py-2 rounded text-sm font-medium transition-all ${c==="2d"?"bg-orange-600 text-white shadow-lg":"text-gray-300 hover:bg-gray-700 hover:text-white"}`,title:"Switch to 2D orthographic view for precision drawing",children:[e("span",{className:"mr-2",children:"ðŸ“"}),"2D Draw"]}),t("button",{onClick:()=>y({viewMode:"3d"}),className:`px-4 py-2 rounded text-sm font-medium transition-all ${c==="3d"?"bg-orange-600 text-white shadow-lg":"text-gray-300 hover:bg-gray-700 hover:text-white"}`,title:"Switch to 3D perspective view for modeling",children:[e("span",{className:"mr-2",children:"ðŸ§Š"}),"3D Model"]})]}),c==="2d"&&e("div",{className:"flex bg-gray-800 rounded-lg p-1 space-x-1",children:r.map(n=>t("button",{onClick:()=>y({view2DMode:n.id}),className:`px-2 py-1 rounded text-xs font-medium transition-all ${s===n.id?"bg-orange-600 text-white shadow-lg":"text-gray-300 hover:bg-gray-600 hover:text-white"}`,title:`${n.name} view (${n.key})`,children:[e("span",{className:"mr-1",children:n.icon}),n.name]},n.id))}),e("div",{className:"text-xs text-gray-400 px-2",children:c==="2d"?`${((l=r.find(n=>n.id===s))==null?void 0:l.name)||"Front"} View â€¢ Draw â†’ Extrude`:"3D Modeling Mode"})]})]}),t("div",{className:"flex items-center justify-between px-2 py-1 bg-gray-800 overflow-x-auto",children:[e("div",{className:"flex items-center",children:p.map(n=>t("div",{className:"relative group",children:[t("button",{className:"flex items-center space-x-1 px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 rounded",children:[e("span",{children:n.icon}),e("span",{children:n.name})]}),e("div",{className:"absolute top-full left-0 mt-1 w-40 bg-gray-900 border border-gray-700 rounded shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50",children:n.items.map(v=>e("button",{onClick:()=>n.hasAction&&n.handler&&n.handler(v),className:`w-full text-left px-3 py-2 text-sm transition-colors first:rounded-t last:rounded-b ${n.hasAction?"text-gray-300 hover:bg-gray-700":"text-gray-500 cursor-not-allowed"}`,disabled:!n.hasAction,children:v},v))})]},n.name))}),c==="2d"&&t("div",{className:"flex items-center space-x-2 text-sm",children:[e("span",{className:"text-gray-400",children:"Current Tool:"}),e("span",{className:"text-orange-400 font-medium",children:d})]}),o.length>0&&t("div",{className:"flex items-center space-x-2 text-sm",children:[e("span",{className:"text-gray-400",children:"Selected:"}),t("span",{className:"text-blue-400 font-medium",children:[o.length," object",o.length>1?"s":""]})]})]})]})},ae=[{name:"Cube",icon:"â¬›",type:"box"},{name:"Sphere",icon:"ðŸŸ ",type:"sphere"},{name:"Cylinder",icon:"ðŸ—œï¸",type:"cylinder"},{name:"Plane",icon:"â–­",type:"plane"},{name:"Cone",icon:"ðŸ”º",type:"cone"},{name:"Boxel",icon:"ðŸ“¦",type:"boxel"}],Ee=()=>{const{addObject:c,selectObjects:s}=F(),d=y=>{const o=`${y}_${Date.now()}`,g=[0,0,0],r=[0,0,0],f=[1,1,1];let h;switch(y){case"box":h=[1,1,1];break;case"sphere":h=[.5,32,16];break;case"cylinder":h=[.5,.5,1,32];break;case"plane":h=[2,2];break;case"cone":h=[.5,1,32];break;case"boxel":h=[1];break;default:h=[1,1,1]}const p={id:o,name:`${y}_${ae.length+1}`,type:"mesh",geometry:y,geometryArgs:h,material:{type:"standard",color:"#ff6600",metalness:.1,roughness:.7},position:g,rotation:r,scale:f,visible:!0,locked:!1};c(p),s([o])};return t("div",{className:"space-y-3",children:[e("h3",{className:"text-white text-sm font-bold",children:"Add Primitives"}),e("div",{className:"grid grid-cols-2 gap-2",children:ae.map(y=>t("button",{className:"px-3 py-2 rounded flex flex-col items-center space-y-1 bg-gray-800 text-gray-200 hover:bg-orange-600 transition-colors",onClick:()=>d(y.type),children:[e("span",{className:"text-lg",children:y.icon}),e("span",{className:"text-xs",children:y.name})]},y.name))})]})},je=[{name:"Extrude",icon:"â¬†ï¸",type:"extrude"},{name:"Revolve",icon:"ðŸ”„",type:"revolve"},{name:"Union",icon:"âž•",type:"union"},{name:"Subtract",icon:"âž–",type:"subtract"},{name:"Intersect",icon:"âœ‚ï¸",type:"intersect"},{name:"Mirror",icon:"ðŸªž",type:"mirror"}],Ge=()=>{const{objects:c,selectedIds:s}=j(),{addObject:d,updateObject:y,selectObjects:o}=F(),g=async l=>{const n=c.filter(N=>s.includes(N.id));if(n.length<2){console.warn(`Need at least 2 objects for ${l}, got ${n.length}`);return}console.log(`ðŸ”§ Creating ${l} operation with ${n.length} objects`);const v=n.map(N=>new z.Vector3(...N.position)),i=v.reduce((N,C)=>N.add(C),new z.Vector3).divideScalar(v.length),m={id:`boolean_${l}_${Date.now()}`,name:`${l.charAt(0).toUpperCase()+l.slice(1)}_${n.length}obj`,type:"boolean",operation:l,sourceObjects:[...s],position:[Math.round(i.x*100)/100,Math.round(i.y*100)/100,Math.round(i.z*100)/100],rotation:[0,0,0],scale:[1,1,1],material:{color:l==="union"?"#4a90e2":l==="subtract"?"#e74c3c":"#f39c12",metalness:.1,roughness:.8,opacity:.9},visible:!0,locked:!1,originalObjects:n.map(N=>({...N}))};try{d(m),s.forEach(N=>{y(N,{visible:!1,hiddenBy:m.id})}),o([m.id]),console.log(`âœ… Successfully created ${l} operation:`,m.id)}catch(N){console.error(`âŒ Failed to create ${l} operation:`,N)}},r=async l=>{const n=c.filter(v=>s.includes(v.id));console.log(`ðŸ› ï¸ Performing ${l} operation on ${n.length} objects`);try{switch(l){case"extrude":n.length===1?await f(n[0]):console.warn("Extrude requires exactly 1 object");break;case"revolve":n.length===1?await h(n[0]):console.warn("Revolve requires exactly 1 object");break;case"union":n.length>=2?await g("union"):console.warn("Union requires at least 2 objects");break;case"subtract":n.length>=2?await g("subtract"):console.warn("Subtract requires at least 2 objects");break;case"intersect":n.length>=2?await g("intersect"):console.warn("Intersect requires at least 2 objects");break;case"mirror":n.length>=1&&await p(n);break;default:console.warn("Unknown operation:",l)}}catch(v){console.error(`âŒ Operation ${l} failed:`,v)}},f=async l=>{const n={id:`extruded_${Date.now()}`,name:`${l.name}_extruded`,type:"mesh",geometry:l.geometry==="plane"?"box":l.geometry,geometryArgs:l.geometryArgs?[l.geometryArgs[0]||1,l.geometryArgs[1]||1,(l.geometryArgs[1]||1)*2]:[1,1,2],material:{...l.material,color:"#2ecc71"},position:[...l.position],rotation:[...l.rotation],scale:[...l.scale],visible:!0,locked:!1,sourceObject:l.id};d(n),o([n.id]),console.log("âœ… Extrude operation completed:",n.id)},h=async l=>{var v;const n={id:`revolved_${Date.now()}`,name:`${l.name}_revolved`,type:"mesh",geometry:"cylinder",geometryArgs:[.5,.5,((v=l.geometryArgs)==null?void 0:v[1])||1,32],material:{...l.material,color:"#e74c3c"},position:[...l.position],rotation:[...l.rotation],scale:[...l.scale],visible:!0,locked:!1,sourceObject:l.id};d(n),o([n.id]),console.log("âœ… Revolve operation completed:",n.id)},p=async l=>{var v;const n=[];for(const i of l){const m={...i,id:`${i.id}_mirror_${Date.now()}`,name:`${i.name}_mirror`,position:[-i.position[0],i.position[1],i.position[2]],material:{...i.material,opacity:(((v=i.material)==null?void 0:v.opacity)||1)*.8},sourceObject:i.id};d(m),n.push(m.id)}o(n),console.log(`âœ… Mirror operation completed: ${n.length} objects created`)};return t("div",{className:"space-y-3",children:[e("h3",{className:"text-white text-sm font-bold",children:"Advanced Operations"}),t("div",{className:"text-xs text-gray-400 mb-2",children:["Selected: ",s.length," object",s.length!==1?"s":""]}),e("div",{className:"grid grid-cols-2 gap-2",children:je.map(l=>{const n=(l.type==="extrude"||l.type==="revolve")&&s.length!==1||["union","subtract","intersect"].includes(l.type)&&s.length<2||l.type==="mirror"&&s.length===0;return t("button",{className:`px-3 py-2 rounded flex flex-col items-center space-y-1 transition-all duration-200 ${n?"bg-gray-800 text-gray-500 cursor-not-allowed opacity-50":"bg-gray-800 text-gray-200 hover:bg-orange-600 hover:scale-105 active:scale-95"}`,onClick:()=>!n&&r(l.type),disabled:n,title:(()=>l.type==="extrude"||l.type==="revolve"?"Select 1 object":["union","subtract","intersect"].includes(l.type)?"Select 2+ objects":l.type==="mirror"?"Select any objects":l.name)(),children:[e("span",{className:"text-lg",children:l.icon}),e("span",{className:"text-xs",children:l.name})]},l.name)})}),e("div",{className:"text-xs text-gray-500 mt-2",children:"ðŸ’¡ Boolean operations hide source objects. Use layers to organize results."})]})},Re=()=>{const[c,s]=$(""),[d,y]=$(!1),[o,g]=$(.7),[r,f]=$(.1),[h,p]=$(1),[l,n]=$(.5),[v,i]=$(0),[m,N]=$(!1),[C,S]=$(!1),[x,D]=$({createGroup:!0,mergeSelectedParcels:!1,autoOptimize:!0,preserveColors:!0}),{addObject:O,selectObjects:a}=F(),M=(()=>{if(c&&c.trim()){const b=parseInt(c.trim());return isNaN(b)?null:b}return null})(),A=async()=>{if(!M||!d){alert("Please enter a bitmon ID and enable the pattern first");return}N(!0);try{const b=de(M);if(!b||!b.slots){alert("Could not generate bitmon layout"),N(!1);return}const w=window.bitmonParcelExtrusions||{},P=window.bitmonSelectedParcels||new Set,T=.1,R=[];b.slots.forEach((U,X)=>{const W=`${M}-${X}`,ge=(U.position.x+U.size/2)*h,ue=(U.position.y+U.size/2)*h,Q=(U.size-T)*h,q=w[W]||r,_=P.has(W),ee={id:`bitmon_${M}_parcel_${X}_${Date.now()}`,name:`Bitmon_${M}_Parcel_${X}`,type:"mesh",geometry:"box",geometryArgs:[Q,q,Q],material:{type:"standard",color:x.preserveColors?_?"#ff6600":"#4a90e2":"#808080",metalness:x.autoOptimize?.1:.2,roughness:x.autoOptimize?.8:.6,emissive:x.preserveColors&&_?"#ff3300":"#000000",emissiveIntensity:x.preserveColors&&_?.1:0},position:[ge,q/2,ue],rotation:[0,0,0],scale:[1,1,1],visible:!0,locked:!1,layerId:"default",bitmonData:{sourceId:M,parcelIndex:X,originalHeight:q,wasSelected:_,slot:{...U},conversionOptions:{...x},convertedAt:Date.now()}};R.push(ee),O(ee)}),a(R.map(U=>U.id)),y(!1),window.bitmonResetAll&&window.bitmonResetAll();const L=Array.from(P).length,H=R.reduce((U,X)=>U+X.geometryArgs[1],0);alert(`Successfully converted bitmon ${M} to ${R.length} 3D objects!

â€¢ Total parcels: ${R.length}
â€¢ Previously selected: ${L}
â€¢ Total volume: ${H.toFixed(2)} units

Objects are now available in the scene and can be:
â€¢ Exported to various formats
â€¢ Modified with material editor
â€¢ Used in boolean operations
â€¢ Transformed and animated`)}catch(b){console.error("Error converting bitmon to scene objects:",b),alert("Error converting bitmon: "+b.message)}N(!1)};B(()=>{const w=setInterval(()=>{window.bitmonSelectedParcels&&i(window.bitmonSelectedParcels.size)},100);return()=>clearInterval(w)},[]);const I=(()=>({count:v,parcels:window.bitmonSelectedParcels?Array.from(window.bitmonSelectedParcels):[]}))(),u=b=>{n(b),window.bitmonUpdateSelectedHeight&&window.bitmonUpdateSelectedHeight(b)};return B(()=>{window.bitmonControls={showBitmon:d,bitmonOpacity:o,bitmonExtrusion:r,bitmonScale:h,currentId:M,selectedParcelHeight:l}},[d,o,r,h,M,l]),t("div",{className:"space-y-4",children:[t("div",{className:"mb-4",children:[e("h3",{className:"text-sm font-medium text-white mb-3",children:"Bitmon Pattern Guide"}),e("div",{className:"mb-4",children:t("label",{className:"flex items-center space-x-2",children:[e("input",{type:"checkbox",checked:d,onChange:b=>y(b.target.checked),className:"w-4 h-4 text-orange-600 bg-gray-700 border-gray-600 rounded focus:ring-orange-500"}),e("span",{className:"text-sm text-gray-300",children:"Show Bitmon Guide"})]})}),d&&t(V,{children:[t("div",{className:"mb-4",children:[e("label",{className:"block text-xs text-gray-400 mb-2",children:"Enter Bitmon Number"}),e("input",{type:"text",value:c,onChange:b=>s(b.target.value),placeholder:"Enter bitmon number...",className:"w-full px-3 py-2 text-sm bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:border-orange-500"}),M!==null&&t("div",{className:"mt-2 p-2 bg-gray-800 rounded",children:[e("div",{className:"text-xs text-gray-400",children:"Displaying Bitmon:"}),e("div",{className:"text-sm text-orange-400 font-mono",children:M})]}),c&&M===null&&e("div",{className:"mt-1 text-xs text-red-400",children:"Please enter a valid bitmon number"})]}),t("div",{className:"mb-4",children:[t("label",{className:"block text-xs text-gray-400 mb-2",children:["Pattern Opacity: ",o.toFixed(1)]}),e("input",{type:"range",min:"0.1",max:"1.0",step:"0.1",value:o,onChange:b=>g(parseFloat(b.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider-orange"})]}),e("div",{className:"mb-4",children:I.count>0?t(V,{children:[t("label",{className:"block text-xs text-gray-400 mb-2",children:["Selected Parcels Height: ",l.toFixed(2)," (",I.count," selected)"]}),e("input",{type:"range",min:"0.05",max:"5.0",step:"0.05",value:l,onChange:b=>u(parseFloat(b.target.value)),className:"w-full h-2 bg-orange-600 rounded-lg appearance-none cursor-pointer slider-orange"}),e("div",{className:"mt-1 text-xs text-orange-400",children:"Controlling selected parcels"})]}):t(V,{children:[t("label",{className:"block text-xs text-gray-400 mb-2",children:["Base Extrusion Height: ",r.toFixed(2)]}),e("input",{type:"range",min:"0.05",max:"2.0",step:"0.05",value:r,onChange:b=>f(parseFloat(b.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider-orange"}),e("div",{className:"mt-1 text-xs text-gray-500",children:"Default height for new parcels"})]})}),t("div",{className:"mb-4",children:[t("label",{className:"block text-xs text-gray-400 mb-2",children:["Pattern Scale: ",h.toFixed(1)]}),e("input",{type:"range",min:"0.5",max:"3.0",step:"0.1",value:h,onChange:b=>p(parseFloat(b.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider-orange"})]}),M!==null&&t("div",{className:"mb-4 p-3 bg-gray-800 rounded border border-gray-600",children:[e("h4",{className:"text-xs font-medium text-white mb-3",children:"Parcel Controls"}),I.count>0&&t("div",{className:"mb-3 p-2 bg-orange-900/30 rounded border border-orange-600/30",children:[t("div",{className:"text-xs text-orange-300 font-medium",children:[I.count," parcel",I.count>1?"s":""," selected"]}),e("div",{className:"text-xs text-orange-400 mt-1",children:"Use the height slider above to adjust selected parcels"})]}),t("div",{className:"space-y-2",children:[e("button",{onClick:()=>window.bitmonExtrudeAll&&window.bitmonExtrudeAll(),className:"w-full px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white text-xs rounded transition-colors",children:"Extrude All Parcels"}),e("button",{onClick:()=>window.bitmonResetAll&&window.bitmonResetAll(),className:"w-full px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white text-xs rounded transition-colors",children:"Reset All Extrusions"}),I.count>0&&e("button",{onClick:()=>window.bitmonClearSelection&&window.bitmonClearSelection(),className:"w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors",children:"Clear Selection"}),t("div",{className:"border-t border-gray-600 pt-2 mt-3",children:[t("button",{onClick:()=>S(!C),className:"w-full px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white text-xs rounded mb-2 transition-colors",children:["âš™ï¸ ",C?"Hide":"Show"," Conversion Options"]}),C&&t("div",{className:"bg-gray-800 p-2 rounded mb-2 space-y-2",children:[t("div",{className:"flex items-center justify-between",children:[e("label",{className:"text-xs text-gray-300",children:"Preserve Colors"}),e("input",{type:"checkbox",checked:x.preserveColors,onChange:b=>D(w=>({...w,preserveColors:b.target.checked})),className:"w-3 h-3"})]}),t("div",{className:"flex items-center justify-between",children:[e("label",{className:"text-xs text-gray-300",children:"Auto Optimize"}),e("input",{type:"checkbox",checked:x.autoOptimize,onChange:b=>D(w=>({...w,autoOptimize:b.target.checked})),className:"w-3 h-3"})]}),t("div",{className:"flex items-center justify-between",children:[e("label",{className:"text-xs text-gray-300",children:"Create Group"}),e("input",{type:"checkbox",checked:x.createGroup,onChange:b=>D(w=>({...w,createGroup:b.target.checked})),className:"w-3 h-3"})]})]}),e("button",{onClick:A,disabled:!M||!d||m,className:`w-full px-3 py-2 text-white text-xs rounded font-medium transition-colors ${!M||!d||m?"bg-gray-500 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:m?"Converting...":"ðŸ”§ Convert to 3D Objects"}),e("p",{className:"text-xs text-gray-400 mt-1 text-center",children:"Creates exportable 3D objects from the current pattern"})]})]}),t("div",{className:"mt-3 text-xs text-gray-400",children:[e("p",{children:"â€¢ Click parcels to select them"}),e("p",{children:"â€¢ Drag parcels up/down to change height"}),e("p",{children:"â€¢ Use height slider to control selected parcels"}),e("p",{children:"â€¢ Selected parcels are highlighted in orange"}),e("p",{children:"â€¢ Convert to 3D objects to make them exportable"})]})]})]})]}),t("div",{className:"text-xs text-gray-500 mt-4",children:[e("p",{children:"Enter a bitmon number to display its pattern overlay on the grid. Click individual parcels to select them, or drag them vertically to change their height in real-time."}),e("p",{className:"mt-2 font-medium text-green-400",children:'Click "Convert to 3D Objects" to turn the pattern into actual 3D scene objects that can be exported, modified with material editor, and used with boolean operations!'})]})]})},Le=()=>{const{currentTool:c,setSceneState:s}=j(),d=[{name:"Basic Drawing",tools:[{name:"Select",icon:"ðŸ–±ï¸",key:"S",description:"Select and modify objects"},{name:"Line",icon:"ðŸ“",key:"L",description:"Draw straight lines"},{name:"Rectangle",icon:"â¬›",key:"R",description:"Draw rectangles"},{name:"Circle",icon:"â­•",key:"C",description:"Draw circles"}]},{name:"Advanced Drawing",tools:[{name:"Polygon",icon:"ðŸ”º",key:"P",description:"Draw polygons"},{name:"Arc",icon:"ðŸŒ™",key:"A",description:"Draw arcs"},{name:"Spline",icon:"ã€°ï¸",key:"SP",description:"Draw spline curves"},{name:"Path",icon:"âœï¸",key:"PT",description:"Draw freehand paths"}]},{name:"Modify Tools",tools:[{name:"Trim",icon:"âœ‚ï¸",key:"T",description:"Trim lines and curves"},{name:"Extend",icon:"â†”ï¸",key:"EX",description:"Extend lines"},{name:"Fillet",icon:"â†ªï¸",key:"F",description:"Create rounded corners"},{name:"Offset",icon:"ðŸ“",key:"O",description:"Offset curves"}]}],y=o=>{s({currentTool:o})};return t("div",{className:"space-y-4",children:[e("div",{className:"text-orange-400 text-sm font-semibold mb-3",children:"2D Sketch Tools"}),d.map((o,g)=>t("div",{className:`${g>0?"mt-4 pt-4 border-t border-gray-700":""}`,children:[e("div",{className:"text-gray-400 text-xs font-medium mb-2",children:o.name}),e("div",{className:"space-y-1",children:o.tools.map(r=>t("button",{className:`w-full px-3 py-2 rounded text-sm flex items-center space-x-2 transition-all ${c===r.name?"bg-orange-600 text-white shadow-lg":"bg-gray-700 text-gray-200 hover:bg-gray-600 hover:text-white"}`,onClick:()=>y(r.name),title:`${r.description} (${r.key})`,children:[e("span",{className:"text-lg",children:r.icon}),t("div",{className:"flex-1 text-left",children:[e("div",{className:"font-medium",children:r.name}),e("div",{className:"text-xs opacity-60",children:r.key})]})]},r.name))})]},o.name)),t("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[t("div",{className:"text-gray-400 text-xs",children:["Current Tool: ",e("span",{className:"text-orange-400 font-medium",children:c})]}),e("div",{className:"text-gray-400 text-xs mt-1",children:"Press keyboard shortcuts for quick tool switching"})]})]})},Fe=()=>{const{currentTool:c,setSceneState:s}=j(),d=[{name:"Geometric Constraints",tools:[{name:"Parallel",icon:"â€–",key:"PA",description:"Make lines parallel"},{name:"Perpendicular",icon:"âŠ¥",key:"PE",description:"Make lines perpendicular"},{name:"Tangent",icon:"ðŸ”—",key:"TA",description:"Make line tangent to curve"},{name:"Coincident",icon:"â—",key:"CO",description:"Make points coincident"}]},{name:"Dimensional Constraints",tools:[{name:"Distance",icon:"ðŸ“",key:"DI",description:"Set distance between points"},{name:"Angle",icon:"ðŸ“",key:"AN",description:"Set angle between lines"},{name:"Radius",icon:"â­•",key:"RA",description:"Set circle radius"},{name:"Diameter",icon:"âŠ•",key:"DA",description:"Set circle diameter"}]},{name:"Equality Constraints",tools:[{name:"Equal Length",icon:"=",key:"EL",description:"Make lines equal length"},{name:"Equal Radius",icon:"âŠš",key:"ER",description:"Make circles equal radius"},{name:"Symmetric",icon:"â†”ï¸",key:"SY",description:"Make objects symmetric"},{name:"Concentric",icon:"âŠ™",key:"CC",description:"Make circles concentric"}]}],y=o=>{s({currentTool:o})};return t("div",{className:"space-y-4",children:[e("div",{className:"text-orange-400 text-sm font-semibold mb-3",children:"Sketch Constraints"}),d.map((o,g)=>t("div",{className:`${g>0?"mt-4 pt-4 border-t border-gray-700":""}`,children:[e("div",{className:"text-gray-400 text-xs font-medium mb-2",children:o.name}),e("div",{className:"space-y-1",children:o.tools.map(r=>t("button",{className:`w-full px-3 py-2 rounded text-sm flex items-center space-x-2 transition-all ${c===r.name?"bg-orange-600 text-white shadow-lg":"bg-gray-700 text-gray-200 hover:bg-gray-600 hover:text-white"}`,onClick:()=>y(r.name),title:`${r.description} (${r.key})`,children:[e("span",{className:"text-lg",children:r.icon}),t("div",{className:"flex-1 text-left",children:[e("div",{className:"font-medium",children:r.name}),e("div",{className:"text-xs opacity-60",children:r.key})]})]},r.name))})]},o.name)),t("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[e("div",{className:"text-gray-400 text-xs",children:"Select objects first, then apply constraints"}),e("div",{className:"text-gray-400 text-xs mt-1",children:"Fully constrained sketches are ready for 3D operations"})]})]})},Ve=()=>{const{currentTool:c,setSceneState:s,snapToGrid:d,gridSize:y}=j(),o=[{name:"Linear",icon:"ðŸ“",key:"DL",description:"Linear dimension"},{name:"Angular",icon:"ðŸ“",key:"DA",description:"Angular dimension"},{name:"Radial",icon:"âšª",key:"DR",description:"Radial dimension"},{name:"Diameter",icon:"âŠ•",key:"DD",description:"Diameter dimension"}],g=[{name:"Measure",icon:"ðŸ“Š",key:"M",description:"Measure distance"},{name:"Area",icon:"â¬œ",key:"AR",description:"Measure area"},{name:"Perimeter",icon:"ðŸ”²",key:"PE",description:"Measure perimeter"},{name:"Angle",icon:"ðŸ“",key:"AM",description:"Measure angle"}],r=p=>{s({currentTool:p})},f=()=>{s({snapToGrid:!d})},h=p=>{s({gridSize:p})};return t("div",{className:"space-y-4",children:[e("div",{className:"text-orange-400 text-sm font-semibold mb-3",children:"Dimensions & Measurements"}),t("div",{children:[e("div",{className:"text-gray-400 text-xs font-medium mb-2",children:"Dimension Tools"}),e("div",{className:"space-y-1",children:o.map(p=>t("button",{className:`w-full px-3 py-2 rounded text-sm flex items-center space-x-2 transition-all ${c===p.name?"bg-orange-600 text-white shadow-lg":"bg-gray-700 text-gray-200 hover:bg-gray-600 hover:text-white"}`,onClick:()=>r(p.name),title:`${p.description} (${p.key})`,children:[e("span",{className:"text-lg",children:p.icon}),t("div",{className:"flex-1 text-left",children:[e("div",{className:"font-medium",children:p.name}),e("div",{className:"text-xs opacity-60",children:p.key})]})]},p.name))})]}),t("div",{className:"pt-4 border-t border-gray-700",children:[e("div",{className:"text-gray-400 text-xs font-medium mb-2",children:"Measurement Tools"}),e("div",{className:"space-y-1",children:g.map(p=>t("button",{className:`w-full px-3 py-2 rounded text-sm flex items-center space-x-2 transition-all ${c===p.name?"bg-orange-600 text-white shadow-lg":"bg-gray-700 text-gray-200 hover:bg-gray-600 hover:text-white"}`,onClick:()=>r(p.name),title:`${p.description} (${p.key})`,children:[e("span",{className:"text-lg",children:p.icon}),t("div",{className:"flex-1 text-left",children:[e("div",{className:"font-medium",children:p.name}),e("div",{className:"text-xs opacity-60",children:p.key})]})]},p.name))})]}),t("div",{className:"pt-4 border-t border-gray-700",children:[e("div",{className:"text-gray-400 text-xs font-medium mb-2",children:"Grid & Snap Settings"}),t("div",{className:"space-y-3",children:[t("div",{className:"flex items-center justify-between",children:[e("span",{className:"text-sm text-gray-300",children:"Snap to Grid"}),e("button",{onClick:f,className:`w-12 h-6 rounded-full transition-colors ${d?"bg-orange-600":"bg-gray-600"}`,children:e("div",{className:`w-5 h-5 bg-white rounded-full transition-transform ${d?"translate-x-6":"translate-x-0.5"}`})})]}),t("div",{children:[e("label",{className:"text-sm text-gray-300 block mb-1",children:"Grid Size"}),t("select",{value:y,onChange:p=>h(parseFloat(p.target.value)),className:"w-full px-2 py-1 bg-gray-700 text-white rounded text-sm",children:[e("option",{value:.1,children:"0.1m"}),e("option",{value:.25,children:"0.25m"}),e("option",{value:.5,children:"0.5m"}),e("option",{value:1,children:"1m"}),e("option",{value:2,children:"2m"}),e("option",{value:5,children:"5m"})]})]})]})]}),e("div",{className:"mt-4 pt-4 border-t border-gray-700",children:e("div",{className:"text-gray-400 text-xs",children:"Dimensions help create precise technical drawings"})})]})},Be=()=>{const{selectedIds:c,transformMode:s,setSceneState:d}=j(),y=[{id:"translate",icon:"â†”ï¸",name:"Move",key:"G",description:"Move objects in 3D space"},{id:"rotate",icon:"ðŸ”„",name:"Rotate",key:"R",description:"Rotate objects around axes"},{id:"scale",icon:"â†—ï¸",name:"Scale",key:"S",description:"Scale objects uniformly or per axis"}],o=g=>{d({transformMode:g})};return c.length===0?t("div",{className:"space-y-4",children:[e("div",{className:"text-orange-400 text-sm font-semibold mb-3",children:"Transform Tools"}),e("div",{className:"text-gray-400 text-sm text-center py-8",children:"Select objects to access transform tools"})]}):t("div",{className:"space-y-4",children:[e("div",{className:"text-orange-400 text-sm font-semibold mb-3",children:"Transform Tools"}),e("div",{className:"bg-gray-800 rounded p-3 mb-4",children:t("div",{className:"text-gray-300 text-sm font-medium mb-2",children:["Selection: ",c.length," object",c.length>1?"s":""]})}),e("div",{className:"space-y-2",children:y.map(g=>t("button",{onClick:()=>o(g.id),className:`w-full px-3 py-2 rounded text-sm flex items-center space-x-2 transition-all ${s===g.id?"bg-orange-600 text-white shadow-lg":"bg-gray-700 text-gray-200 hover:bg-gray-600 hover:text-white"}`,title:`${g.description} (${g.key})`,children:[e("span",{className:"text-lg",children:g.icon}),t("div",{className:"flex-1 text-left",children:[e("div",{className:"font-medium",children:g.name}),e("div",{className:"text-xs opacity-60",children:g.key})]})]},g.id))}),t("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[t("div",{className:"text-gray-400 text-xs",children:["Current Mode: ",e("span",{className:"text-orange-400 font-medium",children:s||"translate"})]}),e("div",{className:"text-gray-400 text-xs mt-1",children:"Use keyboard shortcuts for quick switching"})]})]})};function Ye(c,s){let d;return function(...y){clearTimeout(d),d=setTimeout(()=>c.apply(this,y),s)}}const Ue=()=>{const{selectedObjectId:c,objects:s,selectedIds:d}=j(),{updateObject:y}=F(),[o,g]=$({}),[r,f]=$(.1),h=c?s.find(i=>i.id===c):d.length>0?s.find(i=>i.id===d[0]):null;B(()=>{h&&h.material?(g({...h.material}),f(h.angle||.1)):(g({color:"#808080",metalness:.1,roughness:.8,opacity:1,emissive:"#000000",emissiveIntensity:0}),f(.1))},[h,c,d]);const p=G(Ye((i,m)=>{y(i,m)},16),[]),l=i=>{h&&(f(i),p(h.id,{angle:i}))},n=(i,m)=>{h&&g(N=>{const C={...N,[i]:m};return p(h.id,{material:C}),C})};if(!h)return t("div",{className:"text-gray-400 text-center py-8",children:[e("div",{className:"text-4xl mb-2",children:"ðŸŽ¨"}),e("p",{children:"Select an object to edit materials"})]});const v=(h==null?void 0:h.material)||{};return t("div",{className:"space-y-4",children:[e("div",{className:"flex justify-between items-center",children:e("h3",{className:"text-white text-sm font-bold",children:"Material Editor"})}),e("div",{className:"mb-4",children:t("p",{className:"text-xs text-gray-400 mb-2",children:["Object: ",(h==null?void 0:h.type)||(h==null?void 0:h.geometry)," (",h==null?void 0:h.id.slice(0,8),"...)"]})}),t("div",{className:"mb-4",children:[e("label",{className:"block text-xs text-gray-400 mb-2",children:"Color:"}),t("div",{className:"flex items-center space-x-2",children:[e("input",{type:"color",value:v.color||"#808080",onChange:i=>n("color",i.target.value),className:"w-8 h-8 rounded border border-gray-600"}),e("input",{type:"text",value:v.color||"#808080",onChange:i=>n("color",i.target.value),className:"flex-1 px-2 py-1 bg-gray-800 text-white rounded text-xs",placeholder:"#808080"})]})]}),t("div",{className:"mb-4",children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Metalness: ",(v.metalness||.1).toFixed(2)]}),e("input",{type:"range",min:"0",max:"1",step:"0.01",value:v.metalness||.1,onChange:i=>n("metalness",parseFloat(i.target.value)),className:"w-full"})]}),t("div",{className:"mb-4",children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Roughness: ",(v.roughness||.8).toFixed(2)]}),e("input",{type:"range",min:"0",max:"1",step:"0.01",value:v.roughness||.8,onChange:i=>n("roughness",parseFloat(i.target.value)),className:"w-full"})]}),t("div",{className:"mb-4",children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Opacity: ",(v.opacity||1).toFixed(2)]}),e("input",{type:"range",min:"0",max:"1",step:"0.01",value:v.opacity||1,onChange:i=>n("opacity",parseFloat(i.target.value)),className:"w-full"})]}),t("div",{className:"mb-4",children:[e("label",{className:"block text-xs text-gray-400 mb-2",children:"Emissive:"}),t("div",{className:"flex items-center space-x-2",children:[e("input",{type:"color",value:v.emissive||"#000000",onChange:i=>n("emissive",i.target.value),className:"w-8 h-8 rounded border border-gray-600"}),e("input",{type:"text",value:v.emissive||"#000000",onChange:i=>n("emissive",i.target.value),className:"flex-1 px-2 py-1 bg-gray-800 text-white rounded text-xs",placeholder:"#000000"})]})]}),t("div",{className:"mb-4",children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Emissive Intensity: ",(v.emissiveIntensity||0).toFixed(2)]}),e("input",{type:"range",min:"0",max:"2",step:"0.01",value:v.emissiveIntensity||0,onChange:i=>n("emissiveIntensity",parseFloat(i.target.value)),className:"w-full"})]}),t("div",{className:"mb-4",children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Shape Angle: ",r.toFixed(2)]}),e("input",{type:"range",min:"0.01",max:"0.99",step:"0.01",value:r,onChange:i=>l(parseFloat(i.target.value)),className:"w-full"}),e("p",{className:"text-xs text-gray-500 mt-1",children:"Modifies the shape's angles and curves"})]}),t("div",{className:"mb-4",children:[e("label",{className:"block text-xs text-gray-400 mb-2",children:"Presets:"}),t("div",{className:"grid grid-cols-2 gap-1",children:[e("button",{className:"px-2 py-1 bg-gray-700 text-white rounded text-xs hover:bg-gray-600",onClick:()=>{const i={...h.material,color:"#808080",metalness:0,roughness:.9};y(h.id,{material:i})},children:"Plastic"}),e("button",{className:"px-2 py-1 bg-gray-700 text-white rounded text-xs hover:bg-gray-600",onClick:()=>{const i={...h.material,color:"#c0c0c0",metalness:1,roughness:.2};y(h.id,{material:i})},children:"Metal"}),e("button",{className:"px-2 py-1 bg-gray-700 text-white rounded text-xs hover:bg-gray-600",onClick:()=>{const i={...h.material,color:"#8B4513",metalness:0,roughness:.8};y(h.id,{material:i})},children:"Wood"}),e("button",{className:"px-2 py-1 bg-gray-700 text-white rounded text-xs hover:bg-gray-600",onClick:()=>{n("color","#ffffff"),n("metalness",0),n("roughness",.1),n("opacity",.3)},children:"Glass"})]})]})]})},He=()=>{const{objects:c,selectedIds:s,setSceneState:d}=j(),{selectObjects:y,deleteObject:o}=F(),g=p=>{d(l=>({objects:l.objects.map(n=>n.id===p?{...n,visible:!n.visible}:n)}))},r=p=>{d(l=>({objects:l.objects.map(n=>n.id===p?{...n,locked:!n.locked}:n)}))},f=p=>{o(p)},h=p=>{y([p])};return t("div",{className:"space-y-3",children:[t("h3",{className:"text-white text-sm font-bold",children:["Objects (",c.length,")"]}),c.length===0?t("div",{className:"text-gray-400 text-center py-8",children:[e("div",{className:"text-4xl mb-2",children:"ðŸ“¦"}),e("p",{children:"No objects in scene"})]}):e("div",{className:"space-y-1 max-h-96 overflow-y-auto",children:c.map(p=>t("div",{className:`flex items-center space-x-2 p-1 rounded text-xs cursor-pointer ${s.includes(p.id)?"bg-orange-600":"bg-gray-700 hover:bg-gray-600"}`,onClick:()=>h(p.id),children:[e("button",{className:`w-4 h-4 text-xs ${p.visible?"text-green-400":"text-gray-500"}`,onClick:l=>{l.stopPropagation(),g(p.id)},children:"ðŸ‘"}),e("button",{className:`w-4 h-4 text-xs ${p.locked?"text-red-400":"text-gray-500"}`,onClick:l=>{l.stopPropagation(),r(p.id)},children:"ðŸ”’"}),e("span",{className:"flex-1 truncate",children:p.name}),e("button",{className:"w-4 h-4 text-red-400 hover:text-red-300",onClick:l=>{l.stopPropagation(),f(p.id)},children:"âœ•"})]},p.id))})]})};function Xe(){const{layers:c,objects:s}=j(),[d,y]=$(""),o=()=>console.log("Layer management temporarily disabled"),g=()=>console.log("Layer management temporarily disabled"),r=()=>console.log("Layer management temporarily disabled"),f=()=>console.log("Layer management temporarily disabled"),h=()=>console.log("Layer management temporarily disabled"),[p,l]=$(!1),n=()=>{d.trim()&&(o({id:Date.now().toString(),name:d.trim(),visible:!0,locked:!1,color:`#${Math.floor(Math.random()*16777215).toString(16)}`}),y(""))},v=S=>{c.length>1&&g()},i=(S,x)=>{S.dataTransfer.setData("text/plain",x)},m=S=>{S.preventDefault()},N=(S,x)=>{S.preventDefault(),S.dataTransfer.getData("text/plain"),f()},C=S=>s.filter(x=>x.layerId===S);return p?t("div",{className:"absolute top-20 right-2 z-20 bg-gray-900 text-white p-4 rounded-lg shadow-xl w-80 max-h-96 overflow-y-auto",children:[t("div",{className:"flex justify-between items-center mb-3",children:[e("h3",{className:"text-lg font-semibold",children:"Layer Manager"}),e("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-white",children:"âœ•"})]}),t("div",{className:"mb-4 flex gap-2",children:[e("input",{type:"text",value:d,onChange:S=>y(S.target.value),onKeyDown:S=>S.key==="Enter"&&n(),placeholder:"New layer name",className:"flex-1 px-2 py-1 bg-gray-700 text-white rounded border border-gray-600 focus:border-orange-500 outline-none"}),e("button",{onClick:n,className:"px-3 py-1 bg-orange-600 text-white rounded hover:bg-orange-700",children:"+"})]}),e("div",{className:"space-y-2",children:c.map(S=>{const x=C(S.id);return t("div",{className:"border border-gray-700 rounded p-2",onDragOver:m,onDrop:D=>N(D,S.id),children:[t("div",{className:"flex items-center justify-between mb-2",children:[t("div",{className:"flex items-center gap-2 flex-1",children:[e("div",{className:"w-4 h-4 rounded border border-gray-600",style:{backgroundColor:S.color}}),e("span",{className:"text-sm font-medium",children:S.name}),t("span",{className:"text-xs text-gray-400",children:["(",x.length,")"]})]}),t("div",{className:"flex gap-1",children:[e("button",{onClick:()=>h(S.id),className:`text-xs px-2 py-1 rounded ${S.visible?"bg-green-600 hover:bg-green-700":"bg-gray-600 hover:bg-gray-700"}`,title:S.visible?"Hide layer":"Show layer",children:S.visible?"ðŸ‘ï¸":"ðŸ™ˆ"}),e("button",{onClick:()=>r(S.id,{locked:!S.locked}),className:`text-xs px-2 py-1 rounded ${S.locked?"bg-red-600 hover:bg-red-700":"bg-gray-600 hover:bg-gray-700"}`,title:S.locked?"Unlock layer":"Lock layer",children:S.locked?"ðŸ”’":"ðŸ”“"}),c.length>1&&e("button",{onClick:()=>v(S.id),className:"text-xs px-2 py-1 rounded bg-red-600 hover:bg-red-700",title:"Delete layer",children:"ðŸ—‘ï¸"})]})]}),x.length>0&&e("div",{className:"ml-4 space-y-1",children:x.map(D=>t("div",{draggable:!0,onDragStart:O=>i(O,D.id),className:"flex items-center justify-between p-1 bg-gray-800 rounded text-xs cursor-move hover:bg-gray-700",children:[t("span",{children:[D.type||D.geometry," - ",D.id.slice(0,8)]}),D.material&&e("div",{className:"w-3 h-3 rounded border border-gray-600",style:{backgroundColor:D.material.color||"#ffffff"}})]},D.id))})]},S.id)})}),e("div",{className:"mt-4 text-xs text-gray-400",children:"ðŸ’¡ Drag objects between layers to organize your scene"})]}):e("div",{className:"absolute top-20 right-2 z-20",children:e("button",{onClick:()=>l(!0),className:"px-3 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 shadow-lg",children:"ðŸ“ Layers"})})}const _e=()=>{const{snapToGrid:c,gridSize:s,showGrid:d,setSceneState:y}=j(),o=(g,r)=>{y({[g]:r})};return t("div",{className:"space-y-4",children:[e("h3",{className:"text-white text-sm font-bold",children:"Settings"}),t("div",{className:"mb-4",children:[e("h4",{className:"text-xs text-gray-400 mb-2",children:"Grid & Snap"}),t("div",{className:"flex items-center justify-between mb-2",children:[e("label",{className:"text-xs",children:"Show Grid"}),e("input",{type:"checkbox",checked:d,onChange:g=>o("showGrid",g.target.checked),className:"w-4 h-4"})]}),t("div",{className:"flex items-center justify-between mb-2",children:[e("label",{className:"text-xs",children:"Snap to Grid"}),e("input",{type:"checkbox",checked:c,onChange:g=>o("snapToGrid",g.target.checked),className:"w-4 h-4"})]}),t("div",{className:"mb-2",children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Grid Size: ",s]}),e("input",{type:"range",min:"0.1",max:"2",step:"0.1",value:s,onChange:g=>o("gridSize",parseFloat(g.target.value)),className:"w-full"})]})]}),t("div",{className:"mb-4",children:[e("h4",{className:"text-xs text-gray-400 mb-2",children:"Performance"}),t("div",{className:"text-xs text-gray-300",children:[t("div",{children:["Objects: ",j().objects.length]}),t("div",{children:["Selected: ",j().selectedIds.length]})]})]}),t("div",{className:"mb-4",children:[e("h4",{className:"text-xs text-gray-400 mb-2",children:"Shortcuts"}),t("div",{className:"text-xs text-gray-300 space-y-1",children:[t("div",{children:[e("kbd",{className:"bg-gray-700 px-1 rounded",children:"G"})," - Translate"]}),t("div",{children:[e("kbd",{className:"bg-gray-700 px-1 rounded",children:"R"})," - Rotate"]}),t("div",{children:[e("kbd",{className:"bg-gray-700 px-1 rounded",children:"S"})," - Scale"]}),t("div",{children:[e("kbd",{className:"bg-gray-700 px-1 rounded",children:"Esc"})," - Deselect"]}),t("div",{children:[e("kbd",{className:"bg-gray-700 px-1 rounded",children:"Del"})," - Delete"]})]})]})]})},Ze=c=>`<>
${c.filter(d=>d.visible).map(d=>{const y=qe(d.geometry,d.geometryArgs),o=Je(d.material);return`  <mesh position={[${d.position.join(", ")}]} rotation={[${d.rotation.join(", ")}]} scale={[${d.scale.join(", ")}]}>
    ${y}
    ${o}
  </mesh>`}).join(`
`)}
</>`,Ke=c=>JSON.stringify(c.filter(s=>s.visible).map(s=>({type:s.type,geometry:s.geometry,args:s.geometryArgs,material:s.material,position:s.position,rotation:s.rotation,scale:s.scale})),null,2),qe=(c,s)=>{const d=s?`args={[${s.join(", ")}]}`:"";return`<${c}Geometry ${d} />`},Je=c=>{const s=Object.entries(c).map(([d,y])=>typeof y=="string"?`${d}="${y}"`:`${d}={${y}}`).join(" ");return`<mesh${c.type.charAt(0).toUpperCase()+c.type.slice(1)}Material ${s} />`},We=({onLoadInViewer:c})=>{const{objects:s}=j(),[d,y]=$("jsx"),[o,g]=$(""),r=()=>{const p=d==="jsx"?Ze(s):Ke(s);g(p)},f=()=>{navigator.clipboard.writeText(o)},h=()=>{o&&c&&c(o)};return t("div",{className:"space-y-4",children:[e("h3",{className:"text-white text-sm font-bold",children:"Export Scene"}),t("div",{className:"flex space-x-2",children:[e("button",{className:`px-3 py-1 rounded text-xs ${d==="jsx"?"bg-orange-600":"bg-gray-700"}`,onClick:()=>y("jsx"),children:"JSX"}),e("button",{className:`px-3 py-1 rounded text-xs ${d==="json"?"bg-orange-600":"bg-gray-700"}`,onClick:()=>y("json"),children:"JSON"})]}),t("button",{className:"w-full px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:r,disabled:s.length===0,children:["Generate ",d.toUpperCase()," Code"]}),o&&t("div",{className:"space-y-2",children:[t("div",{className:"flex space-x-2",children:[e("button",{className:"flex-1 px-2 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700",onClick:f,children:"Copy"}),d==="jsx"&&e("button",{className:"flex-1 px-2 py-1 bg-purple-600 text-white rounded text-xs hover:bg-purple-700",onClick:h,children:"View"})]}),e("textarea",{className:"w-full h-24 bg-gray-800 text-white p-2 rounded text-xs font-mono",value:o,readOnly:!0})]}),s.length===0&&t("div",{className:"text-gray-400 text-center py-4",children:[e("div",{className:"text-2xl mb-2",children:"ðŸ“¤"}),e("p",{className:"text-xs",children:"Add objects to export"})]})]})},Qe=({onLoadInViewer:c})=>{var l;const{viewMode:s,selectedIds:d}=j(),[y,o]=$(s==="2d"?"sketch":"primitives"),[g,r]=$(!1),h=[{id:"sketch",name:"Sketch Tools",icon:"âœï¸",component:Le,viewModes:["2d"]},{id:"constraints",name:"Constraints",icon:"ðŸ”—",component:Fe,viewModes:["2d"]},{id:"dimensions",name:"Dimensions",icon:"ðŸ“",component:Ve,viewModes:["2d"]},{id:"primitives",name:"Primitives",icon:"â¬›",component:Ee,viewModes:["3d"]},{id:"advanced",name:"Advanced",icon:"ðŸ”§",component:Ge,viewModes:["3d"]},{id:"bitmon",name:"Bitmon",icon:"ðŸŸ§",component:Re,viewModes:["3d"]},{id:"transform",name:"Transform",icon:"ðŸ”§",component:Be,viewModes:["2d","3d"],conditional:()=>d.length>0},{id:"materials",name:"Materials",icon:"ðŸŽ¨",component:Ue,viewModes:["2d","3d"]},{id:"objects",name:"Objects",icon:"ðŸ“¦",component:He,viewModes:["2d","3d"]},{id:"layers",name:"Layers",icon:"ðŸ“š",component:Xe,viewModes:["2d","3d"]},{id:"export",name:"Export",icon:"ðŸ“¤",component:We,viewModes:["2d","3d"]},{id:"settings",name:"Settings",icon:"âš™ï¸",component:_e,viewModes:["2d","3d"]}].filter(n=>n.viewModes.includes(s)&&(!n.conditional||n.conditional()));Z.useEffect(()=>{d.length>0&&h.some(n=>n.id==="transform")?o("transform"):d.length===0&&y==="transform"&&o(s==="2d"?"sketch":"primitives")},[d.length,s,h,y]),Z.useEffect(()=>{h.some(v=>v.id===y)||o(s==="2d"?"sketch":"primitives")},[s,h,y]);const p=(l=h.find(n=>n.id===y))==null?void 0:l.component;return t("div",{className:`bg-gray-900 border-r border-gray-700 flex flex-col transition-all duration-300 ${g?"w-12":"w-80"}`,children:[t("div",{className:"flex items-center justify-between p-3 border-b border-gray-700",children:[!g&&e("h2",{className:"text-white font-semibold",children:"Tools"}),e("button",{onClick:()=>r(!g),className:"p-1 text-gray-400 hover:text-white rounded",children:g?"â–¶":"â—€"})]}),e("div",{className:`flex ${g?"flex-col":"flex-wrap"} ${g?"items-center":"border-b border-gray-700"}`,children:h.map(n=>t("button",{onClick:()=>o(n.id),className:`${g?"w-10 h-10 m-1":"flex-1 min-w-0 px-3 py-2"} flex items-center justify-center text-sm transition-colors ${y===n.id?"bg-orange-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-800"}`,title:n.name,children:[e("span",{className:"text-lg",children:n.icon}),!g&&e("span",{className:"ml-2 truncate",children:n.name})]},n.id))}),!g&&e("div",{className:"flex-1 overflow-y-auto",children:p&&e("div",{className:"p-4",children:e(p,{onLoadInViewer:c})})})]})},et=()=>{const{objects:c,selectedIds:s,viewMode:d,currentTool:y,snapToGrid:o,gridSize:g,transformMode:r}=j(),f=s.length,h=c.length,p=c.filter(n=>n.visible).length,l=()=>f===0?"Select objects to modify them â€¢ Click primitives in sidebar to add objects":d==="3d"&&f>0?`Transform mode: ${r} â€¢ Press ${r==="translate"?"G":r==="rotate"?"R":r==="scale"?"S":""} to switch â€¢ Drag gizmo to transform`:"Use transform tools or edit properties in the sidebar";return t("div",{className:"bg-gray-900 border-t border-gray-700 px-4 py-2 flex items-center justify-between text-sm text-gray-400",children:[t("div",{className:"flex items-center space-x-4",children:[t("span",{children:["Objects: ",p,"/",h]}),f>0&&t("span",{className:"text-orange-400",children:["Selected: ",f]}),t("span",{children:["Mode: ",d.toUpperCase()]}),d==="2d"&&t("span",{children:["Tool: ",y]})]}),e("div",{className:"text-center flex-1",children:e("span",{className:"text-blue-300",children:l()})}),t("div",{className:"flex items-center space-x-4",children:[t("div",{className:"flex items-center space-x-2",children:[e("span",{className:`w-2 h-2 rounded-full ${o?"bg-green-500":"bg-gray-600"}`}),t("span",{children:["Grid: ",g,"m"]})]}),e("span",{children:"Coords: [0, 0, 0]"})]})]})},tt=()=>{const{transformMode:c,selectedIds:s}=j(),[d,y]=$(!1),[o,g]=$({x:0,y:0});if(B(()=>{if(s.length>0){y(!0);const h=setTimeout(()=>{y(!1)},1500);return()=>clearTimeout(h)}else y(!1)},[c,s]),B(()=>{const h=p=>{g({x:p.clientX,y:p.clientY})};return window.addEventListener("mousemove",h),()=>{window.removeEventListener("mousemove",h)}},[]),!d)return null;const r={translate:{color:"bg-blue-500",icon:"â†”",name:"Move"},rotate:{color:"bg-green-500",icon:"ðŸ”„",name:"Rotate"},scale:{color:"bg-purple-500",icon:"â†—",name:"Scale"}},f=r[c]||r.translate;return e("div",{className:"fixed z-50 pointer-events-none",style:{left:o.x+20,top:o.y+20},children:t("div",{className:`${f.color} text-white text-sm py-1 px-3 rounded-full shadow-lg flex items-center opacity-80`,children:[e("span",{className:"mr-2",children:f.icon}),e("span",{className:"font-medium",children:f.name})]})})},nt=({children:c,onLoadInViewer:s})=>t("div",{className:"w-full h-full flex flex-col bg-gray-800 overflow-hidden",children:[e(Te,{}),t("div",{className:"flex-1 flex overflow-hidden",children:[e(Qe,{onLoadInViewer:s}),t("div",{className:"flex-1 relative bg-gray-900",children:[c,e(tt,{})]})]}),e(et,{})]}),rt=()=>{const{objects:c,selectedIds:s,view2DMode:d}=j(),[y,o]=$([]),[g,r]=$(!0);$(!1),$([]);const f=c.filter(p=>s.includes(p.id));B(()=>{if(f.length===0){o([]);return}const p=[];f.forEach(l=>{if(l.isSketch&&l.sketchData&&l.sketchData.bounds){const n=l.sketchData.bounds;switch(d){case"front":case"back":p.push({type:"horizontal",value:n.width,position:[n.centerX,n.centerY-n.height/2-.5,n.centerZ],label:`${n.width.toFixed(2)}`}),p.push({type:"vertical",value:n.height,position:[n.centerX-n.width/2-.5,n.centerY,n.centerZ],label:`${n.height.toFixed(2)}`});break;case"top":case"bottom":p.push({type:"horizontal",value:n.width,position:[n.centerX,n.centerY,n.centerZ-n.depth/2-.5],label:`${n.width.toFixed(2)}`}),p.push({type:"depth",value:n.depth,position:[n.centerX-n.width/2-.5,n.centerY,n.centerZ],label:`${n.depth.toFixed(2)}`});break;case"right":case"left":p.push({type:"vertical",value:n.height,position:[n.centerX,n.centerY,n.centerZ-n.depth/2-.5],label:`${n.height.toFixed(2)}`}),p.push({type:"depth",value:n.depth,position:[n.centerX,n.centerY-n.height/2-.5,n.centerZ],label:`${n.depth.toFixed(2)}`});break}}}),o(p)},[f,d]);const h=({dimension:p})=>{const{type:l,position:n,label:v,value:i}=p,m=[],N=[...n];switch(l){case"horizontal":m.push(new z.Vector3(n[0]-i/2,n[1],n[2]),new z.Vector3(n[0]+i/2,n[1],n[2]));break;case"vertical":m.push(new z.Vector3(n[0],n[1]-i/2,n[2]),new z.Vector3(n[0],n[1]+i/2,n[2]));break;case"depth":m.push(new z.Vector3(n[0],n[1],n[2]-i/2),new z.Vector3(n[0],n[1],n[2]+i/2));break}return t("group",{children:[e("line",{geometry:new z.BufferGeometry().setFromPoints(m),children:e("lineBasicMaterial",{color:"#00ff00",linewidth:2})}),l==="horizontal"&&t(V,{children:[e("line",{geometry:new z.BufferGeometry().setFromPoints([new z.Vector3(n[0]-i/2,n[1]-.2,n[2]),new z.Vector3(n[0]-i/2,n[1]+.2,n[2])]),children:e("lineBasicMaterial",{color:"#00ff00",linewidth:1})}),e("line",{geometry:new z.BufferGeometry().setFromPoints([new z.Vector3(n[0]+i/2,n[1]-.2,n[2]),new z.Vector3(n[0]+i/2,n[1]+.2,n[2])]),children:e("lineBasicMaterial",{color:"#00ff00",linewidth:1})})]}),t("mesh",{position:N,children:[e("planeGeometry",{args:[.5,.2]}),e("meshBasicMaterial",{color:"#00ff00",transparent:!0,opacity:.8})]})]})};return!g||y.length===0?null:e("group",{children:y.map((p,l)=>e(h,{dimension:p},l))})},st=()=>{const{viewMode:c,objects:s,selectedIds:d}=j(),{addObject:y}=F(),[o,g]=$(!1),[r,f]=$([]),h=s.filter(v=>d.includes(v.id));B(()=>{const v=[];if(c==="2d"){const i=h.filter(m=>m.isSketch);i.length>0&&(v.push({id:"extrude-to-3d",title:"Extrude to 3D",description:"Convert your 2D sketch into a 3D object",icon:"ðŸ—ï¸",action:()=>p(i[0])}),v.push({id:"revolve-to-3d",title:"Revolve to 3D",description:"Revolve your sketch around an axis",icon:"ðŸŒ€",action:()=>l(i[0])})),h.length===0&&v.push({id:"start-sketch",title:"Start Sketching",description:"Begin drawing 2D shapes",icon:"âœï¸",action:()=>{}})}else if(c==="3d"){const i=h.filter(m=>!m.isSketch);i.length===1&&v.push({id:"sketch-on-face",title:"Sketch on Face",description:"Draw 2D shapes on the selected object face",icon:"ðŸ“",action:()=>n(i[0])}),v.push({id:"switch-to-2d",title:"Switch to 2D",description:"Create precise 2D sketches",icon:"ðŸ“",action:()=>{}})}f(v),g(v.length>0)},[c,h]);const p=v=>{if(!v.sketchData)return;const i=v.sketchData.bounds,m=1,N={id:`extruded-${Date.now()}`,type:"object",geometry:"box",geometryArgs:[Math.max(.1,i.width)||1,m,Math.max(.1,i.height)||1],position:[i.centerX||0,i.centerY||0,i.centerZ||0],rotation:[0,0,0],scale:[1,1,1],material:{color:"#4a90e2",metalness:.1,roughness:.8,opacity:1},visible:!0,locked:!1,sourceSketch:v.id};y(N)},l=v=>{if(!v.sketchData)return;const i=v.sketchData.bounds,m={id:`revolved-${Date.now()}`,type:"object",geometry:"cylinder",geometryArgs:[Math.max(.1,i.width/2)||.5,Math.max(.1,i.width/2)||.5,Math.max(.1,i.height)||1,32],position:[i.centerX||0,i.centerY||0,i.centerZ||0],rotation:[0,0,0],scale:[1,1,1],material:{color:"#e74c3c",metalness:.1,roughness:.8,opacity:1},visible:!0,locked:!1,sourceSketch:v.id};y(m)},n=v=>{console.log("Sketching on face of object:",v.id)};return!o||r.length===0?null:t("div",{className:"absolute bottom-20 right-4 z-20 bg-gray-900 bg-opacity-95 rounded-lg shadow-xl border border-gray-700 p-4 max-w-xs",children:[t("div",{className:"flex justify-between items-center mb-3",children:[t("div",{className:"text-white text-sm font-semibold flex items-center",children:[e("span",{className:"mr-2",children:"ðŸ’¡"}),"Quick Actions"]}),e("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-white text-xs",children:"âœ•"})]}),e("div",{className:"space-y-2",children:r.map(v=>e("button",{onClick:v.action,className:"w-full text-left p-3 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors border border-gray-600 hover:border-gray-500",children:t("div",{className:"flex items-start",children:[e("span",{className:"text-lg mr-3",children:v.icon}),t("div",{children:[e("div",{className:"text-white text-sm font-medium",children:v.title}),e("div",{className:"text-gray-400 text-xs mt-1",children:v.description})]})]})},v.id))}),e("div",{className:"mt-3 pt-2 border-t border-gray-600 text-xs text-gray-400",children:c==="2d"?"Create 2D sketches, then convert to 3D":"Model in 3D or sketch on object faces"})]})},at=()=>{const{selectedIds:c,objects:s}=j(),{addObject:d,selectObjects:y}=F(),[o,g]=$("extrude"),[r,f]=$(!1),[h,p]=$(!1),[l,n]=$(!1),[v,i]=$(null),[m,N]=$({extrudeDepth:1,revolveAngle:360,segments:32,steps:1,bevelEnabled:!1,bevelThickness:.1,bevelSize:.1,bevelSegments:3,autoSmooth:!0,generateUVs:!0,doubleSided:!1}),C=K(()=>s.filter(u=>c.includes(u.id)),[s,c]),S=K(()=>{if(h||C.length!==1)return!1;const u=C[0];return u&&(u.type==="sketch"||u.geometry==="plane"||u.geometry==="circle"||u.sketchData&&u.sketchData.points)},[C,h]),x=G(u=>{if(!u||u.length===0)return{width:1,height:1,centerX:0,centerY:0};const b=u.map(H=>H[0]),w=u.map(H=>H[1]),P=Math.min(...b),T=Math.max(...b),R=Math.min(...w),L=Math.max(...w);return{width:Math.max(.1,T-P),height:Math.max(.1,L-R),centerX:(P+T)/2,centerY:(R+L)/2}},[]),D=G(u=>{var b,w,P,T;if(console.log("ðŸ—ï¸ Creating enhanced extruded geometry from sketch:",u.id),u.geometry==="plane")return{geometry:"box",geometryArgs:[((b=u.geometryArgs)==null?void 0:b[0])||2,m.extrudeDepth,((w=u.geometryArgs)==null?void 0:w[1])||2]};if(u.geometry==="circle")return{geometry:"cylinder",geometryArgs:[((P=u.geometryArgs)==null?void 0:P[0])||1,((T=u.geometryArgs)==null?void 0:T[0])||1,m.extrudeDepth,32,1,!1]};if(u.sketchData&&u.sketchData.points){const R=u.sketchData.points,L=x(R);if(R.length===4)return{geometry:"box",geometryArgs:[L.width||1,m.extrudeDepth,L.height||1]};if(R.length>4){const H=Math.max(L.width,L.height)/2;return{geometry:"cylinder",geometryArgs:[H,H,m.extrudeDepth,Math.min(32,Math.max(6,R.length)),1,!1]}}}return{geometry:"box",geometryArgs:[2,m.extrudeDepth,2]}},[m.extrudeDepth,x]),O=G(u=>{var b,w,P,T,R;if(console.log("ðŸŒ€ Creating enhanced revolved geometry from sketch:",u.id),u.geometry==="plane")return{geometry:"cylinder",geometryArgs:[(((b=u.geometryArgs)==null?void 0:b[0])||2)/2,(((w=u.geometryArgs)==null?void 0:w[0])||2)/2,((P=u.geometryArgs)==null?void 0:P[1])||2,m.segments,1,m.revolveAngle<360,0,m.revolveAngle*Math.PI/180]};if(u.geometry==="circle")return{geometry:"torus",geometryArgs:[(((T=u.geometryArgs)==null?void 0:T[0])||1)*1.5,((R=u.geometryArgs)==null?void 0:R[0])||1,16,m.segments,m.revolveAngle*Math.PI/180]};if(u.sketchData&&u.sketchData.points){const L=x(u.sketchData.points);return{geometry:"cylinder",geometryArgs:[Math.max(.1,L.width/2||.5),Math.max(.1,L.width/2||.5),L.height||1,m.segments,1,m.revolveAngle<360,0,m.revolveAngle*Math.PI/180]}}return{geometry:"cylinder",geometryArgs:[.5,.5,2,m.segments,1,!1,0,m.revolveAngle*Math.PI/180]}},[m.segments,m.revolveAngle,x]),a=G((u,b)=>{N(w=>{const P={...w};switch(u){case"extrudeDepth":P[u]=Math.max(.01,Math.min(10,parseFloat(b)||.01));break;case"revolveAngle":P[u]=Math.max(1,Math.min(360,parseInt(b)||1));break;case"segments":P[u]=Math.max(3,Math.min(128,parseInt(b)||3));break;case"steps":P[u]=Math.max(1,Math.min(10,parseInt(b)||1));break;case"bevelThickness":case"bevelSize":P[u]=Math.max(0,Math.min(1,parseFloat(b)||0));break;case"bevelSegments":P[u]=Math.max(1,Math.min(10,parseInt(b)||1));break;default:P[u]=b}return P}),l&&C.length===1&&k()},[l,C]),k=G(()=>{if(!S||C.length!==1)return;const u=C[0],w={...o==="extrude"?D(u):O(u),position:[...u.position],rotation:[0,0,0],scale:[1,1,1],material:{color:o==="extrude"?"#3498db":"#e67e22",metalness:.1,roughness:.8,transparent:!0,opacity:.6,wireframe:!1}};i(w)},[S,C,o,D,O]),M=G(()=>{const u=!l;n(u),u?k():i(null)},[l,k]),A=G(async()=>{if(!S||C.length!==1){console.warn(`Cannot perform ${o}: invalid selection`);return}p(!0),console.log(`ðŸ—ï¸ Starting ${o} operation`);try{const u=C[0],b=o==="extrude"?D(u):O(u),w={id:`${o}_${Date.now()}`,name:`${u.name}_${o}`,type:"3d_generated",sourceSketch:u.id,operation:o,...b,position:[...u.position],rotation:[0,0,0],scale:[1,1,1],material:{color:o==="extrude"?"#2ecc71":"#e74c3c",metalness:.2,roughness:.7,transparent:!1,opacity:1},visible:!0,locked:!1,operationData:{type:o,parameters:{...m},sourceSketch:u.id,createdAt:Date.now()}};d(w),y([w.id]),console.log(`âœ… ${o} operation completed:`,w.id),setTimeout(()=>f(!1),1e3)}catch(u){console.error(`âŒ ${o} operation failed:`,u),alert(`Failed to ${o} sketch. Please try again.`)}finally{p(!1)}},[S,C,o,m,D,O,d,y]),E=()=>{if(!S&&!r){console.warn("Cannot show extrude/revolve panel: no valid sketch selected");return}f(!r)};if(!r)return t("button",{className:`absolute left-2 top-60 px-4 py-2 rounded-lg text-white font-medium transition-all duration-200 ${S?"bg-green-600 hover:bg-green-700 hover:scale-105 shadow-lg":"bg-gray-600 cursor-not-allowed opacity-60"}`,onClick:E,disabled:!S,title:S?"Extrude/Revolve sketch to 3D":"Select a 2D sketch to extrude/revolve",children:[e("span",{className:"mr-2",children:"ðŸ—ï¸"}),"Extrude/Revolve"]});const I=C[0];return t("div",{className:"absolute left-2 top-60 w-80 bg-gray-900 bg-opacity-98 text-white p-4 rounded-lg shadow-xl border border-gray-700",children:[t("div",{className:"flex justify-between items-center mb-4",children:[t("h3",{className:"text-lg font-bold flex items-center",children:[e("span",{className:"mr-2",children:"ðŸ—ï¸"}),"3D Generation"]}),e("button",{className:"text-gray-400 hover:text-white transition-colors",onClick:()=>f(!1),children:"âœ•"})]}),t("div",{className:"mb-4 p-3 bg-gray-800 rounded-lg",children:[e("div",{className:"text-sm font-medium mb-1",children:"Selected Sketch:"}),t("div",{className:"text-xs text-gray-300",children:[(I==null?void 0:I.name)||(I==null?void 0:I.type)||"Unknown",t("span",{className:"text-gray-400 ml-2",children:["(",I==null?void 0:I.id.slice(0,8),"...)"]})]})]}),t("div",{className:"mb-4",children:[e("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Operation:"}),e("div",{className:"flex space-x-2",children:[{id:"extrude",name:"Extrude",icon:"â¬†ï¸",desc:"Push 2D to 3D"},{id:"revolve",name:"Revolve",icon:"ðŸŒ€",desc:"Spin around axis"}].map(u=>e("button",{className:`flex-1 p-3 rounded-lg transition-all duration-200 ${o===u.id?"bg-green-600 text-white border-2 border-green-400":"bg-gray-700 text-gray-300 hover:bg-gray-600 border-2 border-transparent"}`,onClick:()=>g(u.id),children:t("div",{className:"text-center",children:[e("div",{className:"text-xl mb-1",children:u.icon}),e("div",{className:"text-sm font-medium",children:u.name}),e("div",{className:"text-xs opacity-80",children:u.desc})]})},u.id))})]}),t("div",{className:"mb-4 space-y-3",children:[t("div",{className:"flex justify-between items-center",children:[e("h4",{className:"text-sm font-medium text-gray-400",children:"Parameters:"}),e("button",{onClick:M,className:`px-3 py-1 text-xs rounded transition-colors ${l?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:l?"ðŸ‘ï¸ Hide Preview":"ðŸ‘ï¸ Show Preview"})]}),o==="extrude"&&t(V,{children:[t("div",{children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Depth: ",m.extrudeDepth.toFixed(2)]}),e("input",{type:"range",min:"0.01",max:"5",step:"0.01",value:m.extrudeDepth,onChange:u=>a("extrudeDepth",u.target.value),className:"w-full accent-green-500"})]}),t("div",{children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Steps: ",m.steps]}),e("input",{type:"range",min:"1",max:"10",step:"1",value:m.steps,onChange:u=>a("steps",u.target.value),className:"w-full accent-green-500"})]})]}),o==="revolve"&&t(V,{children:[t("div",{children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Angle: ",m.revolveAngle,"Â° ",m.revolveAngle<360?"(Partial)":"(Full)"]}),e("input",{type:"range",min:"10",max:"360",step:"10",value:m.revolveAngle,onChange:u=>a("revolveAngle",u.target.value),className:"w-full accent-orange-500"})]}),t("div",{children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Quality: ",m.segments," segments"]}),e("input",{type:"range",min:"3",max:"64",step:"1",value:m.segments,onChange:u=>a("segments",u.target.value),className:"w-full accent-orange-500"})]})]}),t("div",{className:"border-t border-gray-700 pt-3",children:[t("div",{className:"flex items-center justify-between mb-2",children:[e("label",{className:"text-xs text-gray-400",children:"Auto Smooth"}),e("input",{type:"checkbox",checked:m.autoSmooth,onChange:u=>a("autoSmooth",u.target.checked),className:"accent-blue-500"})]}),t("div",{className:"flex items-center justify-between",children:[e("label",{className:"text-xs text-gray-400",children:"Double Sided"}),e("input",{type:"checkbox",checked:m.doubleSided,onChange:u=>a("doubleSided",u.target.checked),className:"accent-blue-500"})]})]})]}),t("div",{className:"space-y-2",children:[e("button",{className:`w-full px-4 py-3 rounded-lg font-medium transition-all duration-200 ${h?"bg-yellow-600 text-white cursor-wait":"bg-green-600 text-white hover:bg-green-700 hover:shadow-lg active:scale-98"}`,onClick:A,disabled:h,children:h?t("span",{className:"flex items-center justify-center",children:[e("span",{className:"animate-spin mr-2",children:"âš™ï¸"}),"Generating 3D..."]}):t("span",{children:[o==="extrude"?"â¬†ï¸ Extrude":"ðŸŒ€ Revolve"," to 3D"]})}),e("button",{className:"w-full px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",onClick:()=>f(!1),children:"Cancel"})]}),t("div",{className:"mt-4 p-3 bg-gradient-to-r from-blue-900 to-green-900 bg-opacity-50 rounded text-xs",children:[t("div",{className:"font-medium mb-2 flex items-center",children:[e("span",{className:"mr-2",children:"ðŸ’¡"}),"CAD Workflow Guide"]}),t("div",{className:"space-y-2",children:[t("div",{className:"flex items-start",children:[e("span",{className:"text-blue-300 mr-2 font-bold",children:"1."}),e("span",{className:"text-blue-200",children:"Sketch in 2D mode with drawing tools"})]}),t("div",{className:"flex items-start",children:[e("span",{className:"text-green-300 mr-2 font-bold",children:"2."}),e("span",{className:"text-green-200",children:"Select your 2D sketch"})]}),t("div",{className:"flex items-start",children:[e("span",{className:"text-orange-300 mr-2 font-bold",children:"3."}),e("span",{className:"text-orange-200",children:"Choose Extrude/Revolve & adjust parameters"})]}),t("div",{className:"flex items-start",children:[e("span",{className:"text-purple-300 mr-2 font-bold",children:"4."}),e("span",{className:"text-purple-200",children:"Preview and generate 3D model"})]})]}),t("div",{className:"mt-3 pt-2 border-t border-gray-600",children:[e("div",{className:"font-medium mb-1",children:"âœ¨ Pro Tips:"}),t("ul",{className:"space-y-1 text-gray-300",children:[e("li",{children:"â€¢ Use Split View to see 2D and 3D simultaneously"}),e("li",{children:"â€¢ Enable Preview to see changes in real-time"}),t("li",{children:["â€¢ ",o==="extrude"?"Extrude pushes shapes outward":"Revolve spins shapes around center"]}),e("li",{children:"â€¢ Higher quality = more segments but slower performance"})]})]})]})]})},ot=({forceViewMode:c=null})=>{const s=Y(),{transformMode:d,selectedIds:y,viewMode:o,view2DMode:g="front"}=j(),{size:r}=ie(),f=c||o,h=p=>{switch(p){case"front":case"back":return{lockAxis:"z",minDistance:5,maxDistance:50,panConstraint:{x:!0,y:!0,z:!1}};case"right":case"left":return{lockAxis:"x",minDistance:5,maxDistance:50,panConstraint:{x:!1,y:!0,z:!0}};case"top":case"bottom":return{lockAxis:"y",minDistance:5,maxDistance:50,panConstraint:{x:!0,y:!1,z:!0}};default:return{lockAxis:null,minDistance:1,maxDistance:100,panConstraint:{x:!0,y:!0,z:!0}}}};if(B(()=>{var p,l;if(window.cam=s.current,f==="3d")(p=s.current)!=null&&p.moveTo&&(s.current.moveTo(-0,0,0,!0),s.current.rotateTo(.3,1.2,0,!0),s.current.dollyTo(9,!0));else if(f==="2d"){const n=h(g);if((l=s.current)!=null&&l.setPosition){switch(g){case"front":s.current.setPosition(0,0,10,!0),s.current.setTarget(0,0,0,!0);break;case"back":s.current.setPosition(0,0,-10,!0),s.current.setTarget(0,0,0,!0);break;case"right":s.current.setPosition(10,0,0,!0),s.current.setTarget(0,0,0,!0);break;case"left":s.current.setPosition(-10,0,0,!0),s.current.setTarget(0,0,0,!0);break;case"top":s.current.setPosition(0,10,0,!0),s.current.setTarget(0,0,0,!0);break;case"bottom":s.current.setPosition(0,-10,0,!0),s.current.setTarget(0,0,0,!0);break}s.current&&(s.current.minDistance=n.minDistance,s.current.maxDistance=n.maxDistance)}}},[f,g]),ce(()=>{var p,l;if(f==="2d"&&((p=s.current)!=null&&p.camera)){const v=s.current.camera.position;let i;try{i=s.current.getTarget(new z.Vector3)}catch{i=new z.Vector3(0,0,0)}switch(g){case"front":case"back":g==="front"&&v.z<5&&(v.z=Math.max(5,v.z)),g==="back"&&v.z>-5&&(v.z=Math.min(-5,v.z)),i.z=0;break;case"right":case"left":g==="right"&&v.x<5&&(v.x=Math.max(5,v.x)),g==="left"&&v.x>-5&&(v.x=Math.min(-5,v.x)),i.x=0;break;case"top":case"bottom":g==="top"&&v.y<5&&(v.y=Math.max(5,v.y)),g==="bottom"&&v.y>-5&&(v.y=Math.min(-5,v.y)),i.y=0;break}(l=s.current)!=null&&l.setTarget&&s.current.setTarget(i.x,i.y,i.z,!1)}}),o==="2d"){const l=r.width/r.height,n=h(g);return t(V,{children:[e(ve,{makeDefault:!0,left:-50*l,right:50*l,top:50,bottom:-50,near:.1,far:1e3}),e(J,{ref:s,enableRotate:!1,enableZoom:!0,enablePan:!0,minDistance:n.minDistance,maxDistance:n.maxDistance,mouseButtons:{left:1,middle:2,right:0,wheel:2},touches:{one:1,two:2,three:0}})]})}return e(J,{makeDefault:!0,ref:s})},it=({selectedMesh:c,onDraggingChanged:s})=>{var n,v;const{transformMode:d,selectedObjectId:y}=j(),{updateObject:o}=F(),g=Y(),r=Y(!1),f=G(i=>{const m=i.value;r.current=m,console.log("ðŸŽ® Transform dragging changed:",m),window.cam&&(window.cam.enabled=!m,m?window.cam.dampingFactor=.25:window.cam.dampingFactor=.05),s&&s(m)},[s]),h=G(i=>{var N;if(!y||!((N=i==null?void 0:i.target)!=null&&N.object)||!r.current)return;const m=i.target.object;console.log("ðŸ”„ Transform update:",{position:[m.position.x,m.position.y,m.position.z],rotation:[m.rotation.x,m.rotation.y,m.rotation.z],scale:[m.scale.x,m.scale.y,m.scale.z]}),o(y,{position:[Math.round(m.position.x*1e3)/1e3,Math.round(m.position.y*1e3)/1e3,Math.round(m.position.z*1e3)/1e3],rotation:[Math.round(m.rotation.x*1e3)/1e3,Math.round(m.rotation.y*1e3)/1e3,Math.round(m.rotation.z*1e3)/1e3],scale:[Math.max(.01,Math.round(m.scale.x*1e3)/1e3),Math.max(.01,Math.round(m.scale.y*1e3)/1e3),Math.max(.01,Math.round(m.scale.z*1e3)/1e3)]})},[y,o]),p=G(()=>{g.current&&console.log("ðŸŽ¯ Transform controls activated")},[]),l=G(()=>{g.current&&r.current&&(console.log("ðŸŽ¯ Transform controls deactivated"),c&&y&&h({target:{object:c}}))},[c,y,h]);return!c||!y?null:e(we,{ref:g,object:c,mode:d||"translate",onObjectChange:h,onDraggingChanged:f,onMouseDown:p,onMouseUp:l,showX:!0,showY:!0,showZ:!0,space:"world",size:1.2,enabled:!0,visible:!0,lineWidth:3,translationSnap:(n=window.scene)!=null&&n.snapToGrid?((v=window.scene)==null?void 0:v.gridSize)||.5:null,rotationSnap:Math.PI/12,scaleSnap:.1})},ct=()=>{const{objects:c,selectedObjectId:s,selectedIds:d,layers:y,groups:o=[],transformMode:g}=j(),{selectObjects:r,toggleObjectSelection:f,clearSelection:h}=F(),p=Y({}),[l,n]=$(0),v=Y(!1),i=Y(!1);ce((a,k)=>{n(M=>M+k)});const m=c.filter(a=>{const k=y.find(A=>A.id===a.layerId),M=k?k.visible:!0;if(a.groupId){const A=o.find(I=>I.id===a.groupId),E=A?A.visible:!0;return M&&E}return M}),N=(a,k)=>{k.stopPropagation(),i.current=!0,setTimeout(()=>{i.current=!1},100),!v.current&&(k.ctrlKey||k.metaKey?f(a):r([a]))},C=a=>{v.current||i.current||h()},S=()=>s?p.current[s]:null,x=(a,k,M)=>{if(a==="boxel")return se;switch(a){case"box":return e("boxGeometry",{args:k});case"sphere":return e("sphereGeometry",{args:k});case"cylinder":return e("cylinderGeometry",{args:k});case"plane":return e("planeGeometry",{args:k});case"cone":return e("coneGeometry",{args:k});default:return e("boxGeometry",{args:[1,1,1]})}},D=a=>{const k=c.filter(b=>a.sourceObjects.includes(b.id));if(k.length<2)return null;const[M,A,...E]=k,I=b=>[b.position[0]-a.position[0],b.position[1]-a.position[1],b.position[2]-a.position[2]],u=b=>e("mesh",{position:I(b),rotation:b.rotation,scale:b.scale,children:x(b.geometry,b.geometryArgs)});return t(Se,{children:[e(Me,{children:u(M)}),a.operation==="union"&&t(te,{children:[u(A),E.map(b=>e(te,{children:u(b)},b.id))]}),a.operation==="subtract"&&t(ne,{children:[u(A),E.map(b=>e(ne,{children:u(b)},b.id))]}),a.operation==="intersect"&&t(re,{children:[u(A),E.map(b=>e(re,{children:u(b)},b.id))]})]})},O=(a,k,M=!1,A=null)=>{const E=(A==null?void 0:A.angle)||.1;return!M&&E===.1?e("meshStandardMaterial",{transparent:k||(a==null?void 0:a.opacity)!==void 0&&(a==null?void 0:a.opacity)<1,opacity:k?.8:(a==null?void 0:a.opacity)||1,color:k?"#ffaa00":(a==null?void 0:a.color)||"#808080",metalness:(a==null?void 0:a.metalness)||.1,roughness:(a==null?void 0:a.roughness)||.8,emissive:(a==null?void 0:a.emissive)||"#000000",emissiveIntensity:(a==null?void 0:a.emissiveIntensity)||0}):e(De,{baseMaterial:z.MeshStandardMaterial,flatShading:!0,transparent:k||(a==null?void 0:a.opacity)!==void 0&&(a==null?void 0:a.opacity)<1,opacity:k?.8:(a==null?void 0:a.opacity)||1,color:k?"#ffaa00":(a==null?void 0:a.color)||"#808080",metalness:(a==null?void 0:a.metalness)||.1,roughness:(a==null?void 0:a.roughness)||.8,emissive:(a==null?void 0:a.emissive)||"#000000",emissiveIntensity:(a==null?void 0:a.emissiveIntensity)||0,uniforms:{time:{value:l},angle:{value:E}},vertexShader:`
          attribute float angle;
          varying vec3 vPos;
          varying vec3 vNormal;
          uniform float time;
          uniform float angle;
          
          void main() {
            // Use uniform angle instead of template literal
            csm_Position += normal * (angle - 0.2 + 0.01) * 0.5;
            vPos = csm_Position;
            vNormal = normal;
          }
        `,fragmentShader:`
          varying vec3 vPos;
          varying vec3 vNormal;
          uniform float time;
          
          void main() {
            ${k?"float colorPulse = sin(time) * 0.05 + 0.95; csm_DiffuseColor.rgb *= colorPulse;":""}
          }
        `})};return t(V,{children:[!g&&t("mesh",{position:[0,-.01,0],rotation:[-Math.PI/2,0,0],onClick:C,visible:!1,children:[e("planeGeometry",{args:[1e3,1e3]}),e("meshBasicMaterial",{transparent:!0,opacity:0})]}),e("group",{children:m.map(a=>{if(!a.visible)return null;const k=d.includes(a.id);return a.type==="boolean"?t("mesh",{ref:M=>{M&&(p.current[a.id]=M,M.name=`mesh-${a.id}`,M.userData={objectId:a.id,objectType:"boolean"})},position:a.position,rotation:a.rotation,scale:a.scale,onClick:M=>N(a.id,M),children:[D(a),O(a.material,k,!1,a)]},a.id):t("mesh",{ref:M=>{M&&(p.current[a.id]=M,M.name=`mesh-${a.id}`,M.userData={objectId:a.id,objectType:a.geometry,angle:a.angle||.1})},position:a.position,rotation:a.rotation,scale:a.scale,onClick:M=>N(a.id,M),geometry:a.geometry==="boxel"?se:void 0,children:[a.geometry!=="boxel"&&x(a.geometry,a.geometryArgs,a.angle),O(a.material,k,a.geometry==="boxel",a)]},a.id)})}),e(it,{selectedMesh:S(),onDraggingChanged:a=>v.current=a})]})},lt=()=>{const{scene:c,camera:s,gl:d,raycaster:y,pointer:o}=ie(),{currentTool:g,view2DMode:r,snapToGrid:f,gridSize:h}=j(),{addObject:p}=F(),[l,n]=$([]),[v,i]=$(!1);$(null);const m=Y(null),N=Y(null),C=Y(),S=()=>{switch(r){case"front":case"back":return new z.Vector3(0,0,1);case"right":case"left":return new z.Vector3(1,0,0);case"top":case"bottom":return new z.Vector3(0,1,0);default:return new z.Vector3(0,0,1)}},x=I=>{y.setFromCamera(o,s);const u=S(),b=new z.Plane(u,0),w=new z.Vector3;return y.ray.intersectPlane(b,w),f&&(w.x=Math.round(w.x/h)*h,w.y=Math.round(w.y/h)*h,w.z=Math.round(w.z/h)*h),w},D=I=>{I.stopPropagation();const u=x();if(u)switch(i(!0),g){case"Line":case"Path":O(u);break;case"Rectangle":a(u);break}},O=I=>{const u=[I],b=new z.LineBasicMaterial({color:"#ff6600",linewidth:2,transparent:!0,opacity:.9}),w=new z.BufferGeometry().setFromPoints(u),P=new z.Line(w,b);c.add(P),m.current={line:P,points:u,startPoint:I.clone()}},a=I=>{const u=new z.LineBasicMaterial({color:"#ff6600",linewidth:2,transparent:!0,opacity:.9}),b=new z.BufferGeometry,w=new z.LineLoop(b,u);c.add(w),N.current={line:w,startPoint:I.clone()}},k=I=>{if(!v)return;const u=x();if(u){if(g==="Line"&&m.current){const{line:b,points:w}=m.current,P=[...w,u];b.geometry.setFromPoints(P),m.current.points=P}if(g==="Rectangle"&&N.current){const{line:b,startPoint:w}=N.current,P=u.x-w.x,T=u.y-w.y;let R;switch(r){case"front":case"back":R=[new z.Vector3(w.x,w.y,w.z),new z.Vector3(w.x+P,w.y,w.z),new z.Vector3(w.x+P,w.y+T,w.z),new z.Vector3(w.x,w.y+T,w.z)];break;case"right":case"left":R=[new z.Vector3(w.x,w.y,w.z),new z.Vector3(w.x,w.y,w.z+P),new z.Vector3(w.x,w.y+T,w.z+P),new z.Vector3(w.x,w.y+T,w.z)];break;case"top":case"bottom":R=[new z.Vector3(w.x,w.y,w.z),new z.Vector3(w.x+P,w.y,w.z),new z.Vector3(w.x+P,w.y,w.z+T),new z.Vector3(w.x,w.y,w.z+T)];break}b.geometry.setFromPoints(R)}}},M=I=>{if(!v)return;I.stopPropagation(),i(!1);let u=null;if(m.current&&m.current.points.length>1){const{line:b,points:w}=m.current;u={type:"line",points:w.map(P=>[P.x,P.y,P.z]),viewMode:r,bounds:A(w)},E(u),n(P=>[...P,b]),m.current=null}if(N.current){const{line:b,startPoint:w}=N.current,T=b.geometry.attributes.position;if(T&&T.count>0){const R=[];for(let L=0;L<T.count;L++)R.push(new z.Vector3(T.getX(L),T.getY(L),T.getZ(L)));u={type:"rectangle",points:R.map(L=>[L.x,L.y,L.z]),viewMode:r,bounds:A(R)},E(u),n(L=>[...L,b])}N.current=null}},A=I=>{if(!I||I.length===0)return{width:0,height:0,depth:0};const u=I.map(P=>P.x),b=I.map(P=>P.y),w=I.map(P=>P.z);return{width:Math.max(...u)-Math.min(...u),height:Math.max(...b)-Math.min(...b),depth:Math.max(...w)-Math.min(...w),centerX:(Math.max(...u)+Math.min(...u))/2,centerY:(Math.max(...b)+Math.min(...b))/2,centerZ:(Math.max(...w)+Math.min(...w))/2}},E=(I,u)=>{const b=I.bounds,w={id:`sketch-${Date.now()}`,type:"sketch",geometry:"plane",geometryArgs:[Math.max(.1,b.width)||1,Math.max(.1,b.height)||1],position:[b.centerX||0,b.centerY||0,b.centerZ||0],rotation:[0,0,0],scale:[1,1,1],material:{color:"#ff6600",metalness:.1,roughness:.9,opacity:.3,transparent:!0},visible:!0,locked:!1,sketchData:I,isSketch:!0};p(w)};return t(V,{children:[r==="front"||r==="back"?e("gridHelper",{args:[20,20,"#444","#222"],rotation:[0,0,0]}):r==="top"||r==="bottom"?e("gridHelper",{args:[20,20,"#444","#222"],rotation:[0,0,0]}):e("gridHelper",{args:[20,20,"#444","#222"],rotation:[0,0,Math.PI/2]}),t("mesh",{ref:C,rotation:r==="front"||r==="back"?[0,0,0]:r==="top"||r==="bottom"?[-Math.PI/2,0,0]:[0,Math.PI/2,0],position:[0,0,0],onPointerDown:D,onPointerMove:k,onPointerUp:M,children:[e("planeGeometry",{args:[100,100]}),e("meshBasicMaterial",{visible:!1})]}),l.map((I,u)=>e("primitive",{object:I},u))]})},dt=()=>e(le,{environmentIntensity:.75,files:"/content/8c4ea8f9fafef081345ba8a72c08efed2373d0ba33ac92aca5f043071fc42909i0"}),mt=()=>{const c=Y(),{clearSelection:s}=F();K(()=>{try{return ke()||[]}catch(a){return console.warn("Error getting pattern array data:",a),[]}},[]);const[d,y]=$({showBitmon:!1,bitmonIndex:0,bitmonOpacity:.7,bitmonExtrusion:.1,bitmonScale:1}),[o,g]=$({}),[r,f]=$(new Set),[h,p]=$({isDragging:!1,dragStartY:0,dragStartHeight:0,dragParcelId:null,currentDragHeight:0});B(()=>{const k=setInterval(()=>{window.bitmonControls&&y(window.bitmonControls)},100);return()=>clearInterval(k)},[]);const{showBitmon:l,bitmonIndex:n,bitmonOpacity:v,bitmonExtrusion:i,bitmonScale:m}=d,N=d.currentId,C=K(()=>{var a;if(!l||!N)return console.log("No bitmon layout - showBitmon:",l,"selectedId:",N),null;try{console.log("Getting Mondrian layout for ID:",N);const k=de(N);return console.log("Mondrian layout created:",((a=k==null?void 0:k.slots)==null?void 0:a.length)||0,"slots"),k}catch(k){return console.warn("Error getting Mondrian layout for ID",N,":",k),null}},[N,l]);B(()=>{window.gridFloor=c.current},[]);const S=.1,x=(a,k)=>{d.showBitmon&&k.stopPropagation();const M=o[a]||i,A={isDragging:!1,dragStartY:k.clientY,dragStartHeight:M,dragParcelId:a,currentDragHeight:M};p(A);const E=u=>{const b=A.dragStartY-u.clientY,w=b*.01,P=Math.max(.05,A.dragStartHeight+w);!A.isDragging&&Math.abs(b)>5&&(A.isDragging=!0,p(T=>({...T,isDragging:!0})),document.body.style.cursor="ns-resize"),(A.isDragging||Math.abs(b)>5)&&(p(T=>({...T,isDragging:!0,currentDragHeight:P})),g(T=>({...T,[a]:P})))},I=u=>{A.isDragging||f(b=>{const w=new Set(b);return w.has(a)?w.delete(a):w.add(a),w}),p({isDragging:!1,dragStartY:0,dragStartHeight:0,dragParcelId:null,currentDragHeight:0}),document.body.style.cursor="auto",document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",I)};document.addEventListener("mousemove",E),document.addEventListener("mouseup",I)},D=()=>{if(!C||!C.slots)return;const a={};C.slots.forEach((k,M)=>{const A=`${N}-${M}`;a[A]=(o[A]||i)+.5}),g(k=>({...k,...a}))},O=()=>{g({}),f(new Set)};return B(()=>{window.bitmonExtrudeAll=D,window.bitmonResetAll=O,window.bitmonSelectedParcels=r,window.bitmonParcelExtrusions=o,window.bitmonClearSelection=()=>f(new Set),window.bitmonUpdateSelectedHeight=a=>{const k={};r.forEach(M=>{k[M]=a}),r.size>0&&g(M=>({...M,...k}))}},[C,N,o,i,r]),t("group",{children:[t("mesh",{position:[0,-.51,0],rotation:[-Math.PI/2,0,0],onClick:a=>{d.showBitmon||s()},visible:!1,children:[e("planeGeometry",{args:[200,200]}),e("meshBasicMaterial",{transparent:!0,opacity:0})]}),e(Ne,{gridSize:[1,1],cellSize:.1,cellThickness:1,cellColor:"#6f6f6f",sectionSize:1,sectionThickness:1.5,sectionColor:"#ff6600",fadeDistance:200,fadeStrength:50,followCamera:!0,infiniteGrid:!0,position:[0,-.5,0],ref:c,raycast:()=>null}),l&&C&&C.slots&&e("group",{children:C.slots.map((a,k)=>{const M=`${N}-${k}`,A=(a.position.x+a.size/2)*m,E=(a.position.y+a.size/2)*m,I=(a.size-S)*m,u=o[M]||i,b=r.has(M),w=-.5+u/2;return t("group",{children:[t("mesh",{position:[A,w,E],scale:[I,u,I],onPointerDown:P=>x(M,P),onPointerEnter:P=>{h.isDragging||(P.object.material.emissiveIntensity=.4,document.body.style.cursor="pointer")},onPointerLeave:P=>{h.isDragging||(P.object.material.emissiveIntensity=b?.3:.2,document.body.style.cursor="auto")},children:[e("boxGeometry",{args:[1,1,1]}),e("meshStandardMaterial",{color:b?"#ff6600":"#4a90e2",transparent:!0,opacity:v,emissive:b?"#ff3300":"#1a4480",emissiveIntensity:b?.3:.2})]}),h.isDragging&&h.dragParcelId===M&&e("group",{position:[A,w+u/2+.3,E],children:t("mesh",{children:[e("planeGeometry",{args:[.5,.2]}),e("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.9,side:z.DoubleSide})]})})]},k)})})]})},ht=()=>{const{viewMode:c,setSceneState:s}=j(),[d,y]=$("single"),[o,g]=$(.5),[r,f]=$(!1),[h,p]=$("3d"),[l,n]=$("2d"),v=Y(),i=Y(),m=x=>{y(x),x!=="single"?(p("2d"),n("3d"),s({viewMode:"2d"})):s({viewMode:h})},N=()=>{const x=l,D=h;p(x),n(D),s({viewMode:x})},C=x=>{f(!0),x.preventDefault()};B(()=>{const x=O=>{if(!r||!v.current)return;const a=v.current.getBoundingClientRect();let k;d==="horizontal"?k=(O.clientY-a.top)/a.height:k=(O.clientX-a.left)/a.width,g(Math.max(.2,Math.min(.8,k)))},D=()=>{f(!1)};return r&&(document.addEventListener("mousemove",x),document.addEventListener("mouseup",D)),()=>{document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",D)}},[r,d]);const S=(x,D,O={})=>t("div",{className:D,style:O,children:[t(oe,{dpr:1,children:[e(ot,{forceViewMode:x}),e("color",{attach:"background",args:[.02,.02,.022]}),e(Z.Suspense,{fallback:null,children:x==="2d"?e(lt,{}):t(V,{children:[e(dt,{}),e(ct,{}),e(mt,{})]})})]}),e("div",{className:"absolute top-2 left-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded",children:x==="2d"?"2D Drawing":"3D Model"})]});return t("div",{className:"h-full flex flex-col",children:[t("div",{className:"flex items-center justify-between p-2 bg-gray-800 border-b border-gray-700",children:[t("div",{className:"flex items-center space-x-2",children:[e("span",{className:"text-white text-sm font-medium",children:"View:"}),t("div",{className:"flex bg-gray-700 rounded",children:[e("button",{onClick:()=>m("single"),className:`px-3 py-1 text-xs rounded-l ${d==="single"?"bg-orange-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:"Single"}),e("button",{onClick:()=>m("vertical"),className:`px-3 py-1 text-xs ${d==="vertical"?"bg-orange-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:"Split â†”"}),e("button",{onClick:()=>m("horizontal"),className:`px-3 py-1 text-xs rounded-r ${d==="horizontal"?"bg-orange-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:"Split â†•"})]})]}),d==="single"?t("div",{className:"flex bg-gray-700 rounded",children:[e("button",{onClick:()=>s({viewMode:"2d"}),className:`px-3 py-1 text-xs rounded-l ${c==="2d"?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:"ðŸ“ 2D Draw"}),e("button",{onClick:()=>s({viewMode:"3d"}),className:`px-3 py-1 text-xs rounded-r ${c==="3d"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:"ðŸ§Š 3D Model"})]}):t("div",{className:"flex items-center space-x-2",children:[e("button",{onClick:N,className:"px-3 py-1 text-xs bg-gray-700 text-gray-300 hover:bg-gray-600 rounded",title:"Swap viewport views",children:"â‡„ Swap Views"}),t("span",{className:"text-xs text-gray-400",children:["Left: ",h==="2d"?"ðŸ“ 2D":"ðŸ§Š 3D"," | Right: ",l==="2d"?"ðŸ“ 2D":"ðŸ§Š 3D"]})]})]}),e("div",{ref:v,className:"flex-1 relative",children:d==="single"?S(c,"w-full h-full relative"):d==="vertical"?t(V,{children:[S(h,"absolute left-0 top-0 h-full",{width:`${o*100}%`}),S(l,"absolute right-0 top-0 h-full",{width:`${(1-o)*100}%`,left:`${o*100}%`}),e("div",{ref:i,className:"absolute top-0 h-full w-1 bg-gray-600 cursor-col-resize hover:bg-orange-500 transition-colors z-10",style:{left:`calc(${o*100}% - 2px)`},onMouseDown:C})]}):t(V,{children:[S(h,"absolute left-0 top-0 w-full",{height:`${o*100}%`}),S(l,"absolute left-0 w-full",{height:`${(1-o)*100}%`,top:`${o*100}%`}),e("div",{ref:i,className:"absolute left-0 w-full h-1 bg-gray-600 cursor-row-resize hover:bg-orange-500 transition-colors z-10",style:{top:`calc(${o*100}% - 2px)`},onMouseDown:C})]})})]})},gt=()=>{const{selectedIds:c,objects:s,snapSettings:d}=j(),{setSceneState:y,updateObject:o}=F(),[g,r]=$(!1);$("grid"),$("center");const f={enabled:!0,gridSnap:!0,objectSnap:!0,vertexSnap:!0,edgeSnap:!0,gridSize:.5,snapDistance:.25,showSnapIndicators:!0,...d},h=G(i=>{y({snapSettings:{...f,...i}})},[y,f]),p=G(i=>{const m={...f};m[`${i}Snap`]=!m[`${i}Snap`],h(m)},[f,h]),l=G(i=>{if(c.length<2)return;const m=s.filter(D=>c.includes(D.id));if(m.length<2)return;const N=m.reduce((D,O)=>{const a=O.position||[0,0,0];return{minX:Math.min(D.minX,a[0]),maxX:Math.max(D.maxX,a[0]),minY:Math.min(D.minY,a[1]),maxY:Math.max(D.maxY,a[1]),minZ:Math.min(D.minZ,a[2]),maxZ:Math.max(D.maxZ,a[2])}},{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0,minZ:1/0,maxZ:-1/0});let C,S,x;switch(i){case"left":C=N.minX;break;case"right":C=N.maxX;break;case"centerX":C=(N.minX+N.maxX)/2;break;case"top":S=N.maxY;break;case"bottom":S=N.minY;break;case"centerY":S=(N.minY+N.maxY)/2;break;case"front":x=N.maxZ;break;case"back":x=N.minZ;break;case"centerZ":x=(N.minZ+N.maxZ)/2;break}m.forEach(D=>{const O=[...D.position||[0,0,0]];C!==void 0&&(O[0]=C),S!==void 0&&(O[1]=S),x!==void 0&&(O[2]=x),o(D.id,{position:O})}),console.log(`âœ… Aligned ${m.length} objects: ${i}`)},[c,s,o]),n=G(i=>{var O,a;if(c.length<3)return;const m=s.filter(k=>c.includes(k.id));if(m.length<3)return;const N=i==="x"?0:i==="y"?1:2,C=[...m].sort((k,M)=>{var A,E;return(((A=k.position)==null?void 0:A[N])||0)-(((E=M.position)==null?void 0:E[N])||0)}),S=((O=C[0].position)==null?void 0:O[N])||0,D=((((a=C[C.length-1].position)==null?void 0:a[N])||0)-S)/(C.length-1);C.forEach((k,M)=>{if(M===0||M===C.length-1)return;const A=[...k.position||[0,0,0]];A[N]=S+D*M,o(k.id,{position:A})}),console.log(`âœ… Distributed ${m.length} objects along ${i}-axis`)},[c,s,o]),v=G(()=>{if(c.length===0)return;const i=f.gridSize;c.forEach(m=>{const N=s.find(x=>x.id===m);if(!N)return;const S=(N.position||[0,0,0]).map(x=>Math.round(x/i)*i);o(m,{position:S})}),console.log(`âœ… Snapped ${c.length} objects to grid`)},[c,s,o,f.gridSize]);return g?t("div",{className:"fixed right-4 top-32 w-72 bg-gray-900 bg-opacity-95 text-white p-4 rounded-lg shadow-xl border border-gray-700 z-50",children:[t("div",{className:"flex justify-between items-center mb-4",children:[t("h3",{className:"text-lg font-bold flex items-center",children:[e("span",{className:"mr-2",children:"ðŸ“"}),"Snap & Align"]}),e("button",{className:"text-gray-400 hover:text-white transition-colors",onClick:()=>r(!1),children:"âœ•"})]}),t("div",{className:"mb-4",children:[e("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Snap Settings:"}),e("div",{className:"space-y-2",children:[{key:"grid",label:"ðŸ”² Grid Snap",color:"blue"},{key:"object",label:"ðŸ“¦ Object Snap",color:"green"},{key:"vertex",label:"ðŸ“ Vertex Snap",color:"orange"},{key:"edge",label:"ðŸ“ Edge Snap",color:"purple"}].map(({key:i,label:m,color:N})=>t("div",{className:"flex items-center justify-between",children:[e("span",{className:"text-sm",children:m}),e("button",{onClick:()=>p(i),className:`px-2 py-1 text-xs rounded transition-colors ${f[`${i}Snap`]?`bg-${N}-600 text-white`:"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:f[`${i}Snap`]?"ON":"OFF"})]},i))}),t("div",{className:"mt-3",children:[t("label",{className:"block text-xs text-gray-400 mb-1",children:["Grid Size: ",f.gridSize]}),e("input",{type:"range",min:"0.1",max:"2.0",step:"0.1",value:f.gridSize,onChange:i=>h({gridSize:parseFloat(i.target.value)}),className:"w-full accent-blue-500"})]})]}),t("div",{className:"mb-4",children:[e("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Quick Actions:"}),t("div",{className:"grid grid-cols-2 gap-2",children:[e("button",{onClick:v,disabled:c.length===0,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-xs rounded transition-colors",children:"ðŸ”² Snap to Grid"}),e("button",{onClick:()=>h({enabled:!f.enabled}),className:`px-3 py-2 text-xs rounded transition-colors ${f.enabled?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:f.enabled?"âœ… Snap ON":"âŒ Snap OFF"})]})]}),c.length>=2&&t("div",{className:"mb-4",children:[t("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:["Align (",c.length," selected):"]}),e("div",{className:"grid grid-cols-3 gap-1 mb-2",children:[{action:"left",label:"â†",title:"Align Left"},{action:"centerX",label:"â†”",title:"Center Horizontally"},{action:"right",label:"â†’",title:"Align Right"},{action:"top",label:"â†‘",title:"Align Top"},{action:"centerY",label:"â†•",title:"Center Vertically"},{action:"bottom",label:"â†“",title:"Align Bottom"}].map(({action:i,label:m,title:N})=>e("button",{onClick:()=>l(i),title:N,className:"px-2 py-1 bg-purple-600 hover:bg-purple-700 text-xs rounded transition-colors",children:m},i))})]}),c.length>=3&&t("div",{className:"mb-4",children:[t("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:["Distribute (",c.length," selected):"]}),e("div",{className:"flex space-x-2",children:[{axis:"x",label:"â†” X-Axis"},{axis:"y",label:"â†• Y-Axis"},{axis:"z",label:"âš¡ Z-Axis"}].map(({axis:i,label:m})=>e("button",{onClick:()=>n(i),className:"flex-1 px-2 py-1 bg-orange-600 hover:bg-orange-700 text-xs rounded transition-colors",children:m},i))})]}),e("div",{className:"text-xs text-gray-400",children:"ðŸ’¡ Select objects to enable alignment and distribution tools"})]}):e("button",{className:"fixed right-4 top-32 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-lg transition-all duration-200 z-50",onClick:()=>r(!0),title:"Snap & Align Tools",children:"ðŸ“ Snap"})},ut=()=>{const{viewMode:c,currentTool:s,objects:d,selectedIds:y}=j(),{setSceneState:o,addObject:g,selectObjects:r}=F(),[f,h]=$(!1),[p,l]=$("freehand"),n=[{id:"line",name:"Line",icon:"ðŸ“",hotkey:"L",category:"basic",description:"Draw straight lines"},{id:"rectangle",name:"Rectangle",icon:"â–­",hotkey:"R",category:"basic",description:"Draw rectangles and squares"},{id:"circle",name:"Circle",icon:"â—‹",hotkey:"C",category:"basic",description:"Draw circles and ellipses"},{id:"polygon",name:"Polygon",icon:"â¬Ÿ",hotkey:"P",category:"basic",description:"Draw multi-sided polygons"},{id:"bezier",name:"Bezier",icon:"ðŸŒŠ",hotkey:"B",category:"advanced",description:"Draw curved paths"},{id:"arc",name:"Arc",icon:"â—",hotkey:"A",category:"advanced",description:"Draw circular arcs"},{id:"spline",name:"Spline",icon:"ã€°ï¸",hotkey:"S",category:"advanced",description:"Draw smooth curves"},{id:"dimension",name:"Dimension",icon:"ðŸ“",hotkey:"D",category:"annotation",description:"Add dimensions and measurements"}],v=[{id:"square",name:"Square",icon:"â¬œ",size:[1,1]},{id:"circle",name:"Circle",icon:"â­•",radius:.5},{id:"triangle",name:"Triangle",icon:"ðŸ”º",sides:3},{id:"hexagon",name:"Hexagon",icon:"â¬¡",sides:6}],i=G(x=>{o({currentTool:x,viewMode:"2d"})},[o]),m=G(x=>{const D={id:`primitive_${Date.now()}`,name:`${x.name}_${Date.now()}`,type:"sketch",geometry:x.id==="square"?"plane":x.id,geometryArgs:x.size||[x.radius||.5],position:[0,0,0],rotation:[0,0,0],scale:[1,1,1],material:{color:"#3498db",wireframe:!0,transparent:!0,opacity:.8},visible:!0,locked:!1,sketchData:{type:x.id,created:Date.now(),points:N(x)}};g(D),r([D.id]),console.log(`âœ… Created primitive ${x.name}:`,D.id)},[g,r]),N=x=>{switch(x.id){case"square":const D=x.size[0]/2;return[[-D,-D],[D,-D],[D,D],[-D,D],[-D,-D]];case"circle":const O=x.radius,a=[];for(let A=0;A<=32;A++){const E=A/32*Math.PI*2;a.push([Math.cos(E)*O,Math.sin(E)*O])}return a;case"triangle":const k=.5;return[[0,k],[-k*Math.sin(Math.PI*2/3),-k*Math.cos(Math.PI*2/3)],[k*Math.sin(Math.PI*2/3),-k*Math.cos(Math.PI*2/3)],[0,k]];case"hexagon":const M=[];for(let A=0;A<=6;A++){const E=A/6*Math.PI*2;M.push([Math.cos(E)*.5,Math.sin(E)*.5])}return M;default:return[[0,0]]}},C=G(()=>{o({viewMode:"3d",currentTool:"select"})},[o]),S=d.filter(x=>x.type==="sketch"||x.sketchData&&x.sketchData.points);return c!=="2d"?e("div",{className:"fixed left-4 bottom-20 flex flex-col space-y-2",children:e("button",{onClick:()=>o({viewMode:"2d"}),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-lg transition-all duration-200",title:"Switch to 2D drawing mode",children:"ðŸ“ 2D Draw"})}):t("div",{className:"fixed left-4 bottom-20 w-64 bg-gray-900 bg-opacity-95 text-white rounded-lg shadow-xl border border-gray-700",children:[e("div",{className:"p-3 border-b border-gray-700",children:t("div",{className:"flex justify-between items-center",children:[t("h3",{className:"font-bold text-sm flex items-center",children:[e("span",{className:"mr-2",children:"ðŸ“"}),"2D Drawing Tools"]}),t("div",{className:"flex space-x-1",children:[e("button",{onClick:()=>h(!f),className:`px-2 py-1 text-xs rounded ${f?"bg-orange-600":"bg-gray-700 hover:bg-gray-600"}`,title:"Toggle advanced tools",children:"âš™ï¸"}),e("button",{onClick:C,className:"px-2 py-1 text-xs bg-purple-600 hover:bg-purple-700 rounded",title:"Switch to 3D modeling",children:"ðŸ§Š 3D"})]})]})}),t("div",{className:"p-3 border-b border-gray-700",children:[e("div",{className:"text-xs text-gray-400 mb-2",children:"Drawing Mode:"}),e("div",{className:"flex space-x-1",children:[{id:"freehand",name:"Free",icon:"âœï¸"},{id:"geometric",name:"Geo",icon:"ðŸ“"},{id:"precise",name:"CAD",icon:"ðŸŽ¯"}].map(x=>t("button",{onClick:()=>l(x.id),className:`flex-1 px-2 py-1 text-xs rounded transition-colors ${p===x.id?"bg-blue-600 text-white":"bg-gray-700 hover:bg-gray-600"}`,title:`${x.name} drawing mode`,children:[x.icon," ",x.name]},x.id))})]}),t("div",{className:"p-3",children:[e("div",{className:"text-xs text-gray-400 mb-2",children:"Basic Tools:"}),e("div",{className:"grid grid-cols-4 gap-1",children:n.filter(x=>x.category==="basic").map(x=>e("button",{onClick:()=>i(x.id),className:`p-2 text-lg rounded transition-all duration-200 ${s===x.id?"bg-green-600 text-white shadow-lg scale-105":"bg-gray-700 hover:bg-gray-600 hover:scale-105"}`,title:`${x.name} (${x.hotkey}) - ${x.description}`,children:x.icon},x.id))})]}),f&&t("div",{className:"p-3 border-t border-gray-700",children:[e("div",{className:"text-xs text-gray-400 mb-2",children:"Advanced Tools:"}),e("div",{className:"grid grid-cols-4 gap-1 mb-3",children:n.filter(x=>x.category==="advanced").map(x=>e("button",{onClick:()=>i(x.id),className:`p-2 text-lg rounded transition-all duration-200 ${s===x.id?"bg-orange-600 text-white shadow-lg scale-105":"bg-gray-700 hover:bg-gray-600 hover:scale-105"}`,title:`${x.name} (${x.hotkey}) - ${x.description}`,children:x.icon},x.id))}),e("div",{className:"text-xs text-gray-400 mb-2",children:"Annotation:"}),e("div",{className:"grid grid-cols-4 gap-1",children:n.filter(x=>x.category==="annotation").map(x=>e("button",{onClick:()=>i(x.id),className:`p-2 text-lg rounded transition-all duration-200 ${s===x.id?"bg-yellow-600 text-white shadow-lg scale-105":"bg-gray-700 hover:bg-gray-600 hover:scale-105"}`,title:`${x.name} (${x.hotkey}) - ${x.description}`,children:x.icon},x.id))})]}),t("div",{className:"p-3 border-t border-gray-700",children:[e("div",{className:"text-xs text-gray-400 mb-2",children:"Quick Shapes:"}),e("div",{className:"grid grid-cols-4 gap-1",children:v.map(x=>e("button",{onClick:()=>m(x),className:"p-2 text-lg bg-gray-700 hover:bg-green-600 rounded transition-all duration-200 hover:scale-105",title:`Create ${x.name}`,children:x.icon},x.id))})]}),S.length>0&&t("div",{className:"p-3 border-t border-gray-700 bg-gradient-to-r from-blue-900 to-purple-900 bg-opacity-50",children:[t("div",{className:"text-xs text-gray-300 mb-2",children:["ðŸš€ Ready for 3D: ",S.length," sketches"]}),t("div",{className:"flex space-x-1",children:[e("button",{onClick:C,className:"flex-1 px-2 py-1 text-xs bg-purple-600 hover:bg-purple-700 rounded transition-colors",children:"ðŸ§Š Model 3D"}),e("button",{onClick:()=>{S.length>0&&(r([S[0].id]),C())},className:"flex-1 px-2 py-1 text-xs bg-green-600 hover:bg-green-700 rounded transition-colors",children:"â¬†ï¸ Extrude"})]})]}),e("div",{className:"p-2 text-xs text-gray-500 border-t border-gray-700",children:"ðŸ’¡ Use hotkeys for quick tool selection â€¢ Hold Shift for constraints"})]})},pt=()=>t(V,{children:[e(ht,{}),e(at,{}),e(rt,{}),e(st,{}),e(gt,{}),e(ut,{})]});function xt(){const[c,s]=$("builder"),[d,y]=$(null);return Ae(),c==="viewer"?e(Oe,{sceneData:d,onBackToBuilder:()=>s("builder")}):t(nt,{onLoadInViewer:o=>{y(o),s("viewer")},children:[e(pt,{}),e(fe,{hidden:window.innerWidth<300}),e(ze,{})]})}ye.createRoot(document.getElementById("root")).render(e(Z.StrictMode,{children:e($e,{children:e(xt,{})})}));
</script>
  <style rel="stylesheet">@font-face{font-family:Gotham;src:url(/content/3e70186d09a3188e0d33758b4cd9773d401e4e6415be4a61146158c29363f450i1);font-weight:400;font-style:normal}@font-face{font-family:Gotham;src:url(/content/0fba757d15ee4a8af1a7460f2e0306795d7da86b4170203619929e02974b1a41i0);font-weight:700;font-style:normal}@font-face{font-family:Gotham;src:url(/content/3e70186d09a3188e0d33758b4cd9773d401e4e6415be4a61146158c29363f450i0);font-weight:400;font-style:italic}@font-face{font-family:Gotham;src:url(/content/3e70186d09a3188e0d33758b4cd9773d401e4e6415be4a61146158c29363f450i2);font-weight:700;font-style:italic}html,body,#root{margin:0;width:100%;height:100%;background:#333;font-family:Gotham,serif}.gloww{text-shadow:0 0 55px #ff9900,0 0 32px rgba(255,119,0,.7),0 0 7px #000,0 0 16px #000,0 0 3px #bf00ff}.slider-orange::-webkit-slider-thumb{-webkit-appearance:none;-moz-appearance:none;appearance:none;height:16px;width:16px;border-radius:50%;background:#ff6600;cursor:pointer;border:2px solid #ff8833;box-shadow:0 0 4px #ff660080}.slider-orange::-webkit-slider-thumb:hover{background:#ff8833;box-shadow:0 0 8px #f60c}.slider-orange::-moz-range-thumb{height:16px;width:16px;border-radius:50%;background:#ff6600;cursor:pointer;border:2px solid #ff8833;box-shadow:0 0 4px #ff660080}.slider-orange::-moz-range-thumb:hover{background:#ff8833;box-shadow:0 0 8px #f60c}
</style>
</head>
<body><div id="root"></div></body>
</html>
